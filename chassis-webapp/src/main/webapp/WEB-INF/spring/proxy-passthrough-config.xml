<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
http://www.springframework.org/schema/integration/file http://www.springframework.org/schema/integration/file/spring-integration-file.xsd
http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http.xsd"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-file="http://www.springframework.org/schema/integration/file"
	xmlns:int-http="http://www.springframework.org/schema/integration/http"
	xmlns:int-mail="http://www.springframework.org/schema/integration/mail">

	<bean
		class="org.springframework.integration.http.inbound.UriPathHandlerMapping" />

	<int:header-enricher input-channel="httpRequestChannel"
		output-channel="transformedChannel">
		<int:header name="foo" value="123"/>
		<int:header name="CAS_PROXY_TICKET" method="getProxyTicket" ref="proxyFetch" />
	</int:header-enricher>
	
	<int:channel id="filteredHttpReplyChannel" />

	<int:header-filter input-channel="httpReplyChannel"
		output-channel="filteredHttpReplyChannel" header-names="Transfer-Encoding" />

	<int-http:inbound-gateway id="httpInbound"
		reply-timeout="10000" request-channel="httpRequestChannel"
		reply-channel="filteredHttpReplyChannel" error-channel="filteredHttpReplyChannel"
		mapped-request-headers="HTTP_REQUEST_HEADERS, X-*"
		mapped-response-headers="HTTP_RESPONSE_HEADERS, X-*"
		extract-reply-payload="true" path="/content/studies" />

	<int-http:outbound-gateway id="httpOutbound"
		request-channel="httpRequestChannel"
		url="http://kwiat33:11901/repo/service/content/studies?ticket={ticket}&amp;foo={foo}"
		charset="UTF-8" reply-channel="httpReplyChannel" http-method="GET"
		expected-response-type="java.lang.String" mapped-request-headers="HTTP_REQUEST_HEADERS, X-*"
		mapped-response-headers="HTTP_RESPONSE_HEADERS, X-*">
		<int-http:uri-variable name="ticket"
			expression="headers.get('CAS_PROXY_TICKET')" />
			<int-http:uri-variable name="foo"
			expression="headers.get('foo')" />
	</int-http:outbound-gateway>

	<int:channel id="httpReplyChannel" />


	<int:channel id="httpRequestChannel">
		<int:interceptors>
			<ref bean="casProxyInterceptor" />
			<int:wire-tap channel="logger" />
		</int:interceptors>
	</int:channel>

 
	
	 
	<int:channel id="transformedChannel" /> 
	<!--
	<int:transformer id="testTransformer" 
		ref="testTransformerBean" input-channel="httpRequestChannel" method="transform" 
		output-channel="transformedChannel" /> <bean id="testTransformerBean" class="org.cggh.chassis.manta.spring.integration.CASTransformer" 
		/> -->

	<bean id="casProxyInterceptor"
		class="org.cggh.chassis.manta.spring.integration.CASInterceptor" />



	<bean id="proxyFetch" class="org.cggh.chassis.manta.spring.integration.CASProxyTicket" />
	
	<int:logging-channel-adapter id="logger"
		level="INFO" />
</beans>

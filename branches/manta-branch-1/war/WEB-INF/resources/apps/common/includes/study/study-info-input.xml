<?oxygen NVDLSchema="../../../../../../../oxygen/samples/nvdl/xhtml-xforms-11-orbeon.nvdl"?>
<div xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:atom="http://www.w3.org/2005/Atom" xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
	class="study-info">
	<xforms:group ref="instance('errors')" model="mod-study-info"
		class="warnings">
		<p align="right" class="warningButton">
			<xforms:trigger>
				<xforms:label class="warningsLabel">Hints</xforms:label>
				<xxforms:show ev:event="DOMActivate" dialog="dia-errors" />
				<xforms:dispatch ev:event="DOMActivate" name="fr-visit-all"
					targetid="error-summary" />
				<xforms:action ev:event="DOMActivate">
					<xforms:setvalue ref="instance('errors')/initialState">false</xforms:setvalue>
				</xforms:action>
			</xforms:trigger>
		</p>
		<!--
			Orbeon Error Summary component, see also:
			http://wiki.orbeon.com/forms/doc/developer-guide/xbl-components/error-summary-component
			- description of fr:error-summary component
			http://www.orbeon.com/orbeon/xforms-government/ - example of
			application using the fr:error-summary component (create a new form
			and see what happens when you enter invalid data)
		-->

		<xxforms:dialog id="dia-errors" appearance="full"
			level="modeless" close="true" draggable="true" visible="false">
			<!-- FIXME: Eclipse complains "invalid content" here -->
			<xforms:label>Warnings</xforms:label>
			<div>
				<fr:error-summary observer="grp-info" id="error-summary"
					errors-count-ref="instance('errors')/errors-count" valid-ref="instance('errors')/valid">
					<fr:label>Please address the warnings given below: </fr:label>
				</fr:error-summary>
				<!--
					<xforms:group ref=".[not(instance('errors')/valid = 'true')]">
					<xforms:label> Form contains <xforms:output
					value="instance('errors')/errors-count" /> warnings (form validity
					<xforms:output value="instance('errors')/valid" /> )
					</xforms:label> </xforms:group>
				-->
			</div>
		</xxforms:dialog>

	</xforms:group>

	<xforms:group model="mod-study-info"
		ref="instance('ins-sq-study-info-entry')/atom:content">

		<xforms:group ref="study-info" id="grp-info">

			<h2>General questions</h2>

			<h3>Study type (WWARN modules)</h3>

			<p>Please select the WWARN modules for which this study has data.</p>

			<p>
				<span id="wwarn-modules-menu-container">
				<xforms:select ref="modules" appearance="full">
					<xforms:label> WWARN modules </xforms:label>
					<xforms:itemset model="mod-study-info"
						nodeset="instance('ins-module-items')/module" class="repeated-element">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
					<xforms:alert>Appropriate questions are displayed only when a module is selected</xforms:alert>
				</xforms:select>
				</span>
			</p>

			<h3>Study dates</h3>

			<xforms:input ref="start">
				<xforms:label>Start </xforms:label>
        <xforms:alert>
          <xforms:output
              value="concat('An invalid date has been entered for the ', name(), ' field')" />
        </xforms:alert>
			</xforms:input>
			<xforms:input ref="end">
				<xforms:label>End </xforms:label>
        <xforms:alert>
          <xforms:output
              value="concat('An invalid date has been entered for the ', name(), ' field')" />
        </xforms:alert>
			</xforms:input>

			<h3>Pathogen Species</h3>

			<xforms:select ref="pathogens" appearance="full">
				<xforms:label class="invisible">Pathogens</xforms:label>
				<xforms:itemset model="mod-study-info"
					nodeset="instance('ins-pathogen-items')/pathogen">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
				<xforms:alert>A pathogen species is expected</xforms:alert>
			</xforms:select>


			<xforms:group ref="sites">
				<h3>Study site(s)</h3>
				<table class="repeat-table">
					<xforms:repeat nodeset="site" id="rep-site">
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img alt="remove" src="/apps/common/theme/remove.gif" />
									</xforms:label>
									<xforms:delete ev:event="DOMActivate" context="."
										nodeset="." at="index('rep-site')" />
								</xforms:trigger>
							</td>
							<td class="form-td">
								<div>
									<xforms:select1 ref="country">
										<xforms:label class="fixed-width">Country</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset nodeset="instance('ins-country-items')/country">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Selecting a Country initialises the map</xforms:alert>
										<!--
											<xxforms:show ev:event="xforms-select" dialog="dia-map"/>
										-->
									</xforms:select1>
								</div>
								<div>
									<!-- if the country has regions, use a select1 -->
									<xforms:group
										ref=".[country/text() = instance('ins-country-items')/country[exists(regions)]/value/text()]">
										<xforms:select1 ref="region">
											<xforms:label class="fixed-width">Region </xforms:label>
											<xforms:itemset
												nodeset="instance('ins-country-items')/country[value/text()=xxforms:context('rep-site')/country/text()]//region">
												<xforms:label ref="label" />
												<xforms:value ref="value" />
											</xforms:itemset>
											<!--
												<xxforms:show ev:event="xforms-select" dialog="dia-map"/>
											-->
										</xforms:select1>
									</xforms:group>
									<!-- if the country has no regions, use an input -->
									<xforms:group
										ref=".[empty(country/text()) or country/text() = instance('ins-country-items')/country[empty(regions)]/value/text()]">
										<xforms:input ref="region">
											<xforms:label class="fixed-width">Region </xforms:label>
											<!--
												<xxforms:show ev:event="xforms-value-changed"
												dialog="dia-map"/>
											-->
											<xforms:alert>
                        <xforms:output
                          value="concat('Enter a value for the ', name(), ' field')" />
											</xforms:alert>
										</xforms:input>
									</xforms:group>
								</div>
								<div>
									<xforms:input ref="district">
										<xforms:label class="fixed-width">District </xforms:label>
										<!--
											<xxforms:show ev:event="xforms-value-changed"
											dialog="dia-map"/>
										-->
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
								</div>
								<div>
									<xforms:input ref="locality">
										<xforms:label class="fixed-width">Locality </xforms:label>
										<!--
											<xxforms:show ev:event="xforms-value-changed"
											dialog="dia-map"/>
										-->
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
								</div>
								<div>
									<xforms:input ref="latitude">
										<xforms:label class="fixed-width">Latitude</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a coordinate value between -180  and 180 for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
								</div>
								<div>
									<xforms:input ref="longitude">
										<xforms:label class="fixed-width">Longitude</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a coordinate value between -180 and 180 for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
								</div>


								<div class="mapPicker">
									<p><b>Drag the pointer to populate the Latitude and Longitude
										fields</b></p>
									<fr:map address-ref="lookupAddress" longitude-ref="longitude"
										latitude-ref="latitude" style="width: 500px; height: 300px">
									</fr:map>
								</div>

								<div>
									<xforms:input ref="siteCode">
										<xforms:label class="fixed-width">Your site
											code</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
								</div>
								<div>
									<xforms:select1 appearance="minimal" ref="testingDelay">
										<xforms:label class="fixed-width">Sampling/testing delay
										</xforms:label>
										<xforms:item>
											<xforms:label><!-- Nullable -->
											</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-testingDelay-items')/testingDelay">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:select1>
								</div>
								<div>
									<xforms:select1 appearance="minimal" ref="anticoagulant">
										<xforms:label class="fixed-width">Anticoagulant
										</xforms:label>
										<xforms:item>
											<xforms:label><!-- Nullable -->
											</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-anticoagulant-items')/anticoagulant">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:select1>
								</div>
								<div>
									<xforms:select1 appearance="minimal"
										ref="transportAndStorageTemperature">
										<xforms:label class="fixed-width">Transport/storage
											temperature
										</xforms:label>
										<xforms:item>
											<xforms:label><!-- Nullable -->
											</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-transportAndStorageTemperature-items')/transportAndStorageTemperature">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:select1>
								</div>
								<xforms:group ref="transmissionIntensity">
									<h3>Transmission intensity</h3>



									<xforms:input ref="annualParasitologicalIncidence"
										class="fourWide">
										<xforms:label class="fixed-width">Annual Parasitological
											Incidence (API)</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
									<xforms:input ref="annualParasitologicalIncidenceYear"
										class="fourWide">
										<xforms:label>in year </xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a recent year for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<br />
									<xforms:input ref="transmissionIntensityAgeFrom"
										class="fourWide">
										<xforms:label class="fixed-width">API derived from age
										</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter an age in years for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<xforms:select1 ref="transmissionIntensityAgeFromUnits"
										appearance="minimal">
										<xforms:label class="invisible">Age units</xforms:label>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-age-unit-items')/ageUnit">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:select1>

									<xforms:input ref="transmissionIntensityAgeTo"
										class="fourWide">
										<xforms:label>to </xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter an age for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<xforms:select1 ref="transmissionIntensityAgeToUnits"
										appearance="minimal">
										<xforms:label class="invisible">Age units</xforms:label>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-age-unit-items')/ageUnit">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:select1>
									<br />
									<xforms:input ref="parasitePrevalence" class="fourWide">
										<xforms:label class="fixed-width">Parasite prevalence
										</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
									<xforms:input ref="parasitePrevalenceYear" class="fourWide">
										<xforms:label>in year </xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a recent year for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<br />
									<xforms:input ref="entomologicalInoculationRate"
										class="fourWide">
										<xforms:label class="fixed-width">Entomological Inoculation
											Rate (EIR)</xforms:label>
										<xforms:hint>Infective bites per person per year (ib/p/year)
										</xforms:hint>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a value for the ', name(), ' field')" />
										</xforms:alert>
									</xforms:input>
									<xforms:input ref="entomologicalInoculationRateYear"
										width="4" class="fourWide">
										<xforms:label>in year </xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter a recent year for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<br />
									<xforms:select1 ref="seasonalTransmission"
										appearance="minimal">
										<xforms:label class="fixed-width">Is transmission seasonal?
										</xforms:label>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-boolean-items')/boolean">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select</xforms:alert>
									</xforms:select1>
									<div class="box">
										<xforms:select ref="transmissionMonths"
											appearance="full" class="scrollableCheckboxes">
											<xforms:label class="scrollableCheckboxesLabel">Select months</xforms:label>
											<xforms:itemset model="mod-study-info"
												nodeset="instance('ins-month-items')/month">
												<xforms:label ref="label" />
												<xforms:value ref="value" />
											</xforms:itemset>
											<xforms:alert>
												<xforms:output
													value="concat('Enter a value for the ', name(), ' field')" />
											</xforms:alert>
										</xforms:select>
									</div>
								</xforms:group>
							</td>
						</tr>
					</xforms:repeat>
					<tr>
						<td class="action-td">
							<xforms:trigger appearance="minimal">
								<xforms:label>
									<img alt="add" src="/apps/common/theme/add.gif" />
								</xforms:label>
								<!--
									<xxforms:show ev:event="DOMActivate" dialog="dia-map"/>
								-->
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="site" at="count(../site)" position="after"
									origin="instance('ins-site-template')" />
							</xforms:trigger>
						</td>
						<td class="add-td">
							<xforms:trigger appearance="minimal">
								<xforms:label>Add a site</xforms:label>
								<!--
									<xxforms:show ev:event="DOMActivate" dialog="dia-map"/>
								-->
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="site" at="count(../site)" position="after"
									origin="instance('ins-site-template')" />
							</xforms:trigger>
						</td>
					</tr>
				</table>
				<!-- 
				this nearly works, but needs to be visible
				-->
				<!--
					<div id="latLongPicker" > <xxforms:dialog id="dia-map"
					appearance="full" level="modeless" close="true" draggable="true"
					visible="true" > <xforms:label>Location</xforms:label> <div>
					<p>Drag the pointer to populate the Latitude and Longitude
					fields.</p> <fr:map address-ref="instance('ins-lookupAddress')"
					longitude-ref="instance('ins-sq-study-info-entry')//sites/site[index('rep-site')]/longitude"
					latitude-ref="instance('ins-sq-study-info-entry')//sites/site[index('rep-site')]/latitude"
					style="width: 600px; height: 400px; "/> </div> </xxforms:dialog>
					</div>
				-->
			</xforms:group>


			<xforms:group ref="inclusionExclusionCriteria">
				<h3 id="inclusionExclusionCriteria">Inclusion/exclusion criteria</h3>
				<xforms:group ref="age">
					<xforms:input ref="minAge" class="fourWide">
						<xforms:label class="fixed-wdith">Age min </xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Enter an age in years for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:input>

					<xforms:select1 ref="minAgeUnits" appearance="minimal">
						<xforms:label class="invisible">Min age units</xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-age-unit-items')/ageUnit">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:select1>

					<xforms:input ref="maxAge" class="fourWide">
						<xforms:label>Age max </xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Enter an age in years for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:input>
					<xforms:select1 ref="maxAgeUnits" appearance="minimal">
						<xforms:label class="invisible">Max age units</xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-age-unit-items')/ageUnit">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:select1>
					<br />
				</xforms:group>
				<xforms:group ref="parasitaemia">
					<xforms:input ref="minParasitaemia" class="fourWide">
						<xforms:label>Parasitaemia min </xforms:label>
						<xforms:hint>Asexual parasites/µL</xforms:hint>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field')" />
						</xforms:alert>
					</xforms:input>

					<xforms:input ref="maxParasitaemia" class="fourWide">
						<xforms:label>Parasitaemia max </xforms:label>
						<xforms:hint>Asexual parasites/µL</xforms:hint>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field')" />
						</xforms:alert>
					</xforms:input>
					<br />
				</xforms:group>

				<xforms:select1 ref="excludeIfPriorAntimalarials"
					appearance="minimal">
					<xforms:label class="fixed-width">Exclude if prior anti-malarials?
					</xforms:label>
					<xforms:item>
						<xforms:label>please select</xforms:label>
						<xforms:value></xforms:value>
					</xforms:item>
					<xforms:itemset model="mod-study-info"
						nodeset="instance('ins-boolean-items')/boolean">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
					<xforms:alert>Please select</xforms:alert>
				</xforms:select1>
				<xforms:group ref="priorAntimalarialsExclusion">



					<div class="box">
						<xforms:select ref="priorAntimalarials" appearance="full"
							class="scrollableCheckboxes">
							<xforms:label class="scrollableCheckboxesLabel"> Prior anti-malarials
							</xforms:label>
							<xforms:item>
								<xforms:label>Any</xforms:label>
								<xforms:value>any</xforms:value>
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-drugMolecule-items')/drugMolecule">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:alert>
								<xforms:output
									value="concat('Enter a value for the ', name(), ' field')" />
							</xforms:alert>
						</xforms:select>
					</div>
					<br style="clear:both;" />
					<xforms:select1 ref="priorAntimalarialsDetermination"
						appearance="minimal">
						<xforms:label class="fixed-width"> How were prior treatments
							determined?</xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-priorAntimalarialsDetermination-items')/priorAntimalarialsDetermination">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field')" />
						</xforms:alert>
					</xforms:select1>

					<xforms:input ref="priorAntimalarialsHistoryWeeks"
						class="fourWide">
						<xforms:label>Number of weeks </xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the ', name(), ' field')" />
						</xforms:alert>
					</xforms:input>
				</xforms:group>

				<br />
				<xforms:select1 ref="pregnancy" appearance="minimal">
					<xforms:label class="fixed-width">Pregnancy</xforms:label>
					<xforms:item>
						<xforms:label>N/A</xforms:label>
						<xforms:value />
					</xforms:item>
					<xforms:item>
						<xforms:label>include</xforms:label>
						<xforms:value>include</xforms:value>
					</xforms:item>
					<xforms:item>
						<xforms:label>exclude</xforms:label>
						<xforms:value>exclude</xforms:value>
					</xforms:item>
					<xforms:alert>
            <xforms:output
              value="concat('Enter a value for the ', name(), ' field')" />
					</xforms:alert>
				</xforms:select1>
				<br />
				<xforms:select1 ref="treatmentReason" appearance="minimal">
					<xforms:label class="fixed-width"> Reason for treatment
					</xforms:label>
					<xforms:itemset model="mod-study-info"
						nodeset="instance('ins-treatmentReason-items')/treatmentReason">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
					<xforms:alert>
						<xforms:output
							value="concat('Enter a value for the ', name(), ' field')" />
					</xforms:alert>
				</xforms:select1>
				<br />
				<xforms:input ref="otherCriteria">
					<xforms:label class="fixed-width">Other criteria</xforms:label>
					<xforms:alert>
						<xforms:output
							value="concat('Enter a value for the ', name(), ' field')" />
					</xforms:alert>
				</xforms:input>


			</xforms:group>


			<xforms:group ref="clinical">
				
				<div id="clinical-questions-container">
				
				<h2>Clinical Questions</h2>

				<h3>Treatments</h3>
				<xforms:group ref="treatment">
					<xforms:group ref="regimens">
						<h5>Regimen</h5>
						<table class="repeat-table">
							<xforms:repeat nodeset="regimen" id="regimen-rep">
								<tr>
									<td class="action-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="/apps/common/theme/remove.gif" alt="remove" />
											</xforms:label>
											<xforms:delete ev:event="DOMActivate" context="."
												nodeset="." at="index('regimen-rep')" />
										</xforms:trigger>
									</td>
									<td class="form-td">
										<xforms:input ref="regimenName">
											<xforms:label class="fixed-width">Regimen
												name</xforms:label>
										</xforms:input>
										<br />
										<xforms:select1 ref="regimenSupervision"
											appearance="minimal">
											<xforms:label class="fixed-width">Supervision
											</xforms:label>
											<xforms:itemset model="mod-study-info"
												nodeset="instance('ins-supervisionType-items')/supervisionType">
												<xforms:label ref="label" />
												<xforms:value ref="value" />
											</xforms:itemset>
										</xforms:select1>
										<br />
										<xforms:input ref="regimenUrl">
											<xforms:label class="fixed-width">Description URL
											</xforms:label>
											<xforms:hint>A URL of a page which describes the regimen
											</xforms:hint>
											<xforms:alert>Enter a valid URL</xforms:alert>
											<xforms:send ev:event="xforms-value-changed"
												submission="sub-check-regimen-url" />
										</xforms:input>

										<xforms:group ref="drugs">
											<table class="repeat-table">
												<xforms:repeat nodeset="drug" id="rep-drug">
													<tr>
														<td>
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<img src="/apps/common/theme/remove.gif" alt="remove" />
																</xforms:label>
																<xforms:delete ev:event="DOMActivate"
																	context="." nodeset="." at="index('rep-drug')" />
															</xforms:trigger>
														</td>
														<td class="form-td">
															<xforms:input ref="name">
																<xforms:label class="fixed-width">Drug name
																</xforms:label>
															</xforms:input>
															<xforms:group ref="activeIngredients">
																<table class="repeat-table">
																	<xforms:repeat nodeset="activeIngredient"
																		id="rep-activeIngredient">
																		<tr>
																			<td>
																				<xforms:trigger appearance="minimal">
																					<xforms:label>
																						<img src="/apps/common/theme/remove.gif" alt="remove" />
																					</xforms:label>
																					<xforms:delete ev:event="DOMActivate"
																						context="." nodeset="."
																						at="index('rep-activeIngredient')" />
																				</xforms:trigger>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="activeIngredientName">
																					<xforms:label>Active ingredient</xforms:label>
																				</xforms:input>
																				<xforms:input ref="activeIngredientMgPerDose"
																					class="fourWide">
																					<xforms:label>Mg per dose</xforms:label>
																				</xforms:input>
																			</td>
																		</tr>
																	</xforms:repeat>
																	<tr>
																		<td class="action-td">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>
																					<img src="/apps/common/theme/add.gif" alt="add" />
																				</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="activeIngredient" at="count(../activeIngredient)"
																					position="after" origin="instance('ins-activeIngredient')" />
																			</xforms:trigger>
																		</td>
																		<td class="add-td">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>Add an active ingredient
																				</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="activeIngredient" at="count(../activeIngredient)"
																					position="after" origin="instance('ins-activeIngredient')" />
																			</xforms:trigger>
																		</td>
																	</tr>
																</table>
															</xforms:group>
															<xforms:select1 ref="administrationRoute"
																appearance="minimal">
																<xforms:label class="fixed-width">Administration
																	Route
																</xforms:label>
																<xforms:itemset model="mod-study-info"
																	nodeset="instance('ins-administrationRoute-items')/administrationRoute">
																	<xforms:label ref="label" />
																	<xforms:value ref="value" />
																</xforms:itemset>
															</xforms:select1>
															<br />
															<xforms:input ref="manufacturer">
																<xforms:label class="fixed-width">Manufacturer
																</xforms:label>
																<xforms:hint>The manufacturer of the
																	drug</xforms:hint>
															</xforms:input>
															<br />
															<xforms:input ref="batchNumber">
																<xforms:label class="fixed-width">Batch Number
																</xforms:label>
																<xforms:hint>The manufacturer of the
																	drug</xforms:hint>
															</xforms:input>
															<br />
															<xforms:input ref="expiryDate">
																<xforms:label class="fixed-width">Expiry date
																</xforms:label>
																<xforms:hint>The date the drug
																	expires</xforms:hint>
															</xforms:input>
															<br />
															<xforms:select1 ref="drugStorage"
																appearance="minimal">
																<xforms:label class="fixed-width">Drug storage
																</xforms:label>
																<xforms:itemset model="mod-study-info"
																	nodeset="instance('ins-drugStorage-items')/drugStorage">
																	<xforms:label ref="label" />
																	<xforms:value ref="value" />
																</xforms:itemset>
															</xforms:select1>
															<br />
															<xforms:select1 ref="drugDosingDeterminant"
																appearance="minimal">
																<xforms:label class="fixed-width">Dosing
																	determinant
																</xforms:label>
																<xforms:item>
																	<xforms:label>please select</xforms:label>
																	<xforms:value />
																</xforms:item>
																<xforms:itemset model="mod-study-info"
																	nodeset="instance('ins-drugDosingDeterminant-items')/drugDosingDeterminant">
																	<xforms:label ref="label" />
																	<xforms:value ref="value" />
																</xforms:itemset>
																<xforms:alert>
																	<xforms:output
																		value="concat('Enter an integer value for the ', name(), ' field ')" />
																</xforms:alert>
															</xforms:select1>
															<xforms:group ref="ageDosing">

																<table class="repeat-table">
																	<tr>
																		<th />
																		<th>Day</th>
																		<th>Hour</th>
																		<!--  FIXME Should this also have units? -->
																		<th>
																			From
																			<span style="font-size:smaller; font-weight: normal;">
																				(years)</span>
																		</th>
																		<th>
																			To
																			<span style="font-size:smaller; font-weight: normal;">
																				(years)</span>
																		</th>
																		<th>Dose</th>
																		<th>Unit</th>
																	</tr>
																	<xforms:repeat nodeset="ageDosingSchedule"
																		id="rep-ageDosingSchedule">
																		<tr>
																			<td>
																				<xforms:trigger appearance="minimal">
																					<xforms:label>
																						<img src="/apps/common/theme/remove.gif" alt="remove" />
																					</xforms:label>
																					<xforms:delete ev:event="DOMActivate"
																						context="." nodeset="."
																						at="index('rep-ageDosingSchedule')" />
																				</xforms:trigger>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="day" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="hour" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="ageFrom" class="fourWide">
																					<xforms:label />
																					<xforms:hint>years</xforms:hint>
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="ageTo" class="fourWide">
																					<xforms:label />
																					<xforms:hint>years</xforms:hint>
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="dose" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:select1 ref="doseUnit"
																					appearance="minimal">
																					<xforms:label />
																					<xforms:item>
																						<xforms:label>Tablets</xforms:label>
																						<xforms:value>tablets</xforms:value>
																					</xforms:item>
																					<xforms:item>
																						<xforms:label>Mg</xforms:label>
																						<xforms:value>mg</xforms:value>
																					</xforms:item>
																				</xforms:select1>
																			</td>
																		</tr>
																	</xforms:repeat>
																	<tr>
																		<td class="action-td">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>
																					<img src="/apps/common/theme/add.gif" alt="add" />
																				</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="ageDosingSchedule" at="count(../ageDosingSchedule)"
																					position="after" origin="instance('ins-ageDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																		<td class="add-td" colspan="6">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>Add a schedule</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="ageDosingSchedule" at="count(../ageDosingSchedule)"
																					position="after" origin="instance('ins-ageDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																	</tr>
																</table>



															</xforms:group>
															<xforms:group ref="wGroupDosing">

																<table class="repeat-table">
																	<tr>
																		<th />
																		<th>Day</th>
																		<th>Hour</th>
																		<th>
																			From
																			<span style="font-size:smaller; font-weight: normal;">
																				(kgs)</span>
																		</th>
																		<th>
																			To
																			<span style="font-size:smaller; font-weight: normal;">
																				(kgs)</span>
																		</th>
																		<th>Dose</th>
																		<th>Unit</th>
																	</tr>
																	<xforms:repeat nodeset="wGroupDosingSchedule"
																		id="rep-wGroupDosingSchedule">
																		<tr>
																			<td>
																				<xforms:trigger appearance="minimal">
																					<xforms:label>
																						<img src="/apps/common/theme/remove.gif" alt="remove" />
																					</xforms:label>
																					<xforms:delete ev:event="DOMActivate"
																						context="." nodeset="."
																						at="index('rep-wGroupDosingSchedule')" />
																				</xforms:trigger>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="day" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="hour" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="wGroupFrom" class="fourWide">
																					<xforms:label />
																					<xforms:hint>kgs</xforms:hint>
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="wGroupTo" class="fourWide">
																					<xforms:label />
																					<xforms:hint>kgs</xforms:hint>
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="dose" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:select1 ref="doseUnit"
																					appearance="minimal">
																					<xforms:label />
																					<xforms:item>
																						<xforms:label>Tablets</xforms:label>
																						<xforms:value>tablets</xforms:value>
																					</xforms:item>
																					<xforms:item>
																						<xforms:label>Mg</xforms:label>
																						<xforms:value>mg</xforms:value>
																					</xforms:item>
																				</xforms:select1>
																			</td>
																		</tr>
																	</xforms:repeat>
																	<tr>
																		<td class="action-td">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>
																					<img src="/apps/common/theme/add.gif" alt="add" />
																				</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="wGroupDosingSchedule"
																					at="count(../wGroupDosingSchedule)" position="after"
																					origin="instance('ins-wGroupDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																		<td class="add-td" colspan="6">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>Add a schedule</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="wGroupDosingSchedule"
																					at="count(../wGroupDosingSchedule)" position="after"
																					origin="instance('ins-wGroupDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																	</tr>
																</table>


															</xforms:group>
															<xforms:group ref="weightDosing">
																<table class="repeat-table">
																	<tr>
																		<th />
																		<th>Day</th>
																		<th>Hour</th>
																		<th>Dose</th>
																	</tr>
																	<xforms:repeat nodeset="weightDosingSchedule"
																		id="rep-weightDosingSchedule">
																		<tr>
																			<td>
																				<xforms:trigger appearance="minimal">
																					<xforms:label>
																						<img src="/apps/common/theme/remove.gif" alt="remove" />
																					</xforms:label>
																					<xforms:delete ev:event="DOMActivate"
																						context="." nodeset="."
																						at="index('rep-weightDosingSchedule')" />
																				</xforms:trigger>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="day" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="hour" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																			<td class="form-td">
																				<xforms:input ref="dose" class="fourWide">
																					<xforms:label />
																				</xforms:input>
																			</td>
																		</tr>
																	</xforms:repeat>
																	<tr>
																		<td class="action-td">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>
																					<img src="/apps/common/theme/add.gif" alt="add" />
																				</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="weightDosingSchedule"
																					at="count(../weightDosingSchedule)" position="after"
																					origin="instance('ins-weightDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																		<td class="add-td" colspan="3">
																			<xforms:trigger appearance="minimal">
																				<xforms:label>Add a schedule</xforms:label>
																				<xforms:insert ev:event="DOMActivate"
																					context="." nodeset="weightDosingSchedule"
																					at="count(../weightDosingSchedule)" position="after"
																					origin="instance('ins-weightDosingSchedule')" />
																			</xforms:trigger>
																		</td>
																	</tr>
																</table>

															</xforms:group>
															<br />
															<xforms:select1 ref="feeding" appearance="minimal">
																<xforms:label class="fixed-width">Food intake
																</xforms:label>
																<xforms:item>
																	<xforms:label><!-- Nullable -->
																	</xforms:label>
																	<xforms:value />
																</xforms:item>
																<xforms:itemset model="mod-study-info"
																	nodeset="instance('ins-feeding-items')/feeding">
																	<xforms:label ref="label" />
																	<xforms:value ref="value" />
																</xforms:itemset>
																<xforms:item>
																	<xforms:label>other</xforms:label>
																	<xforms:value>other</xforms:value>
																</xforms:item>
															</xforms:select1>
															<xforms:input ref="feedingOther">
																<xforms:label>Feeding regime</xforms:label>
															</xforms:input>
															<xforms:input ref="fatPerMeal">
																<xforms:label>Mg/meal</xforms:label>
															</xforms:input>
															<br />
															<xforms:select1 appearance="minimal"
																ref="readministeredOnVomitting">
																<xforms:label> Was treatment readministered in the
																	event of vomiting? </xforms:label>
																<xforms:item>
																	<xforms:label>unknown</xforms:label>
																	<xforms:value />
																</xforms:item>
																<xforms:itemset model="mod-study-info"
																	nodeset="instance('ins-boolean-items')/boolean">
																	<xforms:label ref="label" />
																	<xforms:value ref="value" />
																</xforms:itemset>
																<xforms:alert>Please select</xforms:alert>
															</xforms:select1>
															<br />
															<xforms:textarea ref="comments">
																<xforms:label>
																	Comments
																	<br />
																	(eg major deviations
																	from normal)
																</xforms:label>
															</xforms:textarea>
														</td>
													</tr>
												</xforms:repeat>
												<tr>
													<td class="action-td">
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<img src="/apps/common/theme/add.gif" alt="add" />
															</xforms:label>
															<xforms:insert ev:event="DOMActivate"
																context="." nodeset="drug" at="count(../drug)" position="after"
																origin="instance('ins-drug')" />
														</xforms:trigger>
													</td>
													<td class="add-td">
														<xforms:trigger appearance="minimal">
															<xforms:label>Add a drug</xforms:label>
															<xforms:insert ev:event="DOMActivate"
																context="." nodeset="drug" at="count(../drug)" position="after"
																origin="instance('ins-drug')" />
														</xforms:trigger>
													</td>
												</tr>
											</table>
										</xforms:group>
									</td>
								</tr>
							</xforms:repeat>
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/add.gif" alt="add" />
										</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="."
											nodeset="regimen" at="count(../regimen)" position="after"
											origin="instance('ins-regimen')" />
									</xforms:trigger>
								</td>
								<td class="add-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>Add a regimen</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="."
											nodeset="regimen" at="count(../regimen)" position="after"
											origin="instance('ins-regimen')" />
									</xforms:trigger>
								</td>
							</tr>
						</table>
					</xforms:group>



					<xforms:group ref="regimenAllocation">

						<xforms:select1 appearance="minimal"
							ref="regimenAllocationMethod">
							<xforms:label class="fixed-width"> Regimen allocation
							</xforms:label>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-regimenAllocationMethod-items')/regimenAllocationMethod">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>

						<xforms:input ref="randomisationProportion">
							<xforms:label> proportion </xforms:label>
						</xforms:input>
						<br />


						<xforms:select1 appearance="minimal" ref="blinding">
							<xforms:label class="fixed-width">Blinding</xforms:label>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-blinding-items')/blinding">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</xforms:group>

				</xforms:group>


				<h4>Followup</h4>
				<xforms:group ref="followup">
					<xforms:input ref="duration" class="fourWide">
						<xforms:label>Maximum duration of follow up</xforms:label>
					</xforms:input>
					<br />
					<xforms:select1 ref="feverMeasurement" appearance="minimal">
						<xforms:label>Fever measurement</xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-feverMeasurementMethod-items')/feverMeasurementMethod">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
            <xforms:output
              value="concat('Enter a value for the ', name(), ' field')" />
						</xforms:alert>
					</xforms:select1>
					<br />
					<xforms:group ref="haemoglobinRecording">
						<xforms:select1 ref="haemoglobinRecordingType"
							appearance="minimal">
							<xforms:label class="fixed-width">Haemoglobin recording
							</xforms:label>
							<xforms:item>
								<xforms:label />
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-haemoglobinRecordingType-items')/haemoglobinRecordingType">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
						<xforms:select1 ref="haemoglobinRecordingHbType"
							appearance="minimal">
							<xforms:label>hb recording type</xforms:label>
							<xforms:item>
								<xforms:label />
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-haemoglobinRecordingHbType-items')/haemoglobinRecordingHbType">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
						<!--  TODO check is other input box required -->

					</xforms:group>

				</xforms:group>
				<xforms:group ref="microscopy">
					<h4>Microscopy</h4>
					<xforms:select1 ref="microscopyFilmType" appearance="minimal">
						<xforms:label class="fixed-width">Film</xforms:label>
						<xforms:item>
							<xforms:label>please select</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-microscopyFilmType-items')/microscopyFilmType">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the required field ', name())" />
						</xforms:alert>
					</xforms:select1>
					<br />
					<xforms:select1 ref="microscopyStain" appearance="minimal">
						<xforms:label class="fixed-width">Stain</xforms:label>
						<xforms:item>
							<xforms:label>unknown</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-microscopyStain-items')/microscopyStain">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:item>
							<xforms:label>other</xforms:label>
							<xforms:value>other</xforms:value>
						</xforms:item>
					</xforms:select1>

					<xforms:input ref="microscopyStainOther">
						<xforms:label />
					</xforms:input>

					<p>How many fields were reviewed before diagnosis of negative was
						made?</p>
					<xforms:input ref="asexualParasitemiaCount" class="fourWide">
						<xforms:label>Asexual Parasitemia</xforms:label>
					</xforms:input>
					<xforms:select1 ref="asexualParasitemiaCountUnit"
						appearance="minimal">
						<xforms:label>fields per </xforms:label>
						<xforms:item>
							<xforms:label>N/A</xforms:label>
							<xforms:value>na</xforms:value>
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-whiteBloodCellCount-items')/whiteBloodCellCount">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:item>
							<xforms:label>other</xforms:label>
							<xforms:value>other</xforms:value>
						</xforms:item>
					</xforms:select1>
					<xforms:input ref="asexualParasitemiaCountUnitOther">
						<xforms:label />
					</xforms:input>
					<br />
					<xforms:input ref="sexualParasitemiaCount" class="fourWide">
						<xforms:label>Sexual parasitemia</xforms:label>
					</xforms:input>
					<xforms:select1 ref="sexualParasitemiaCountUnit"
						appearance="minimal">
						<xforms:label>fields per </xforms:label>
						<xforms:item>
							<xforms:label>N/A</xforms:label>
							<xforms:value>na</xforms:value>
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-whiteBloodCellCount-items')/whiteBloodCellCount">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:item>
							<xforms:label>other</xforms:label>
							<xforms:value>other</xforms:value>
						</xforms:item>
					</xforms:select1>
					<xforms:input ref="sexualParasitemiaCountUnitOther">
						<xforms:label />
					</xforms:input>



					<br />
					<xforms:select1 ref="separateSpeciesCounts"
						appearance="minimal">
						<xforms:label class="fixed-width">If mixed species, was each
							species	quantified separately?</xforms:label>
						<xforms:item>
							<xforms:label>N/A</xforms:label>
							<xforms:value>na</xforms:value>
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-boolean-items')/boolean">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
              <xforms:output
                value="concat('Enter a value for the ', name(), ' field')" />
		  				</xforms:alert>
					</xforms:select1>

					<xforms:group ref="thickFilmCalculationOfParasitemia">
						<xforms:select1 ref="thickFilmFormula" appearance="minimal">
							<xforms:label>Formula </xforms:label>
							<xforms:item>
								<xforms:label> ( (X per Y WBCs)/ Y) WBC</xforms:label>
								<xforms:value>wbc</xforms:value>
							</xforms:item>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
						</xforms:select1>
						<xforms:input ref="thickFilmFormulaOther">
							<xforms:label />
							<xforms:hint>Enter other formula</xforms:hint>
						</xforms:input>
						<br />
						<xforms:select1 ref="WBCSource" appearance="minimal">
							<xforms:label>WBC source </xforms:label>
							<xforms:item>
								<xforms:label>unknown</xforms:label>
								<xforms:value>unknown</xforms:value>
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-whiteBloodCellCountSource-items')/whiteBloodCellCountSource">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
						<xforms:input ref="WBCAssumed" class="fourWide">
							<xforms:label>WBC per µl</xforms:label>
						</xforms:input>
						<br />
						<xforms:input ref="thickFilmCalculationOfParasitemiaOther">
							<xforms:label>Other method</xforms:label>
						</xforms:input>
					</xforms:group>

					<xforms:group ref="thinFilmCalculationOfParasitemia">
						<xforms:select1 ref="thinFilmFormula" appearance="minimal">
							<xforms:label>Formula </xforms:label>
							<xforms:item>
								<xforms:label> (X per 1000RBCs * 125.6 *) Hct</xforms:label>
								<xforms:value>htc</xforms:value>
							</xforms:item>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
						</xforms:select1>
						<xforms:input ref="thinFilmFormulaOther">
							<xforms:label />
							<xforms:hint>Enter other formula</xforms:hint>
						</xforms:input>
						<br />
						<xforms:select1 ref="HtcSource" appearance="minimal">
							<xforms:label>Htc source </xforms:label>
							<xforms:item>
								<xforms:label>unknown</xforms:label>
								<xforms:value>unknown</xforms:value>
							</xforms:item>

							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-HtcSource-items')/HtcSource">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
						<xforms:input ref="HtcAssumed" class="fourWide">
							<xforms:label>Htc %</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
						<br />
						<xforms:input ref="thinFilmCalculationOfParasitemiaOther">
							<xforms:label>Other method</xforms:label>
						</xforms:input>
					</xforms:group>

					<xforms:group ref="qualityControl">
						<h4>Quality control</h4>
						<xforms:group ref="internal">
							<h5>Internal</h5>
							<xforms:input ref="percentageRereadBySecondMicroscopist"
								class="fourWide">
								<xforms:label>Percentage of slides reread by second microscopist
								</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
							<br />
							<xforms:select1 ref="rereadSlideSelectionMechanism"
								appearance="minimal">
								<xforms:label>How were slides selected to be re-read?
								</xforms:label>
								<xforms:item>
									<xforms:label>unknown</xforms:label>
									<xforms:value>unknown</xforms:value>
								</xforms:item>
								<xforms:item>
									<xforms:label>random</xforms:label>
									<xforms:value>random</xforms:value>
								</xforms:item>
								<xforms:item>
									<xforms:label>other</xforms:label>
									<xforms:value>other</xforms:value>
								</xforms:item>

							</xforms:select1>
							<xforms:input ref="rereadSlideSelectionMechanismOther">
								<xforms:label />
							</xforms:input>
						</xforms:group>
						<xforms:group ref="external">
							<h5>External</h5>
							<xforms:input ref="percentageRereadBySecondMicroscopist"
								class="fourWide">
								<xforms:label>Percentage of slides reread by second microscopist
								</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
							<br />
							<xforms:select1 ref="rereadSlideSelectionMechanism"
								appearance="minimal">
								<xforms:label>How were slides selected to be re-read?
								</xforms:label>
								<xforms:item>
									<xforms:label>unknown</xforms:label>
									<xforms:value>unknown</xforms:value>
								</xforms:item>
								<xforms:item>
									<xforms:label>random</xforms:label>
									<xforms:value>random</xforms:value>
								</xforms:item>
								<xforms:item>
									<xforms:label>other</xforms:label>
									<xforms:value>other</xforms:value>
								</xforms:item>

							</xforms:select1>
							<xforms:input ref="rereadSlideSelectionMechanismOther">
								<xforms:label />
							</xforms:input>
						</xforms:group>
					</xforms:group>
				</xforms:group>
				<h4>Genotyping for recrudescence vs reinfection</h4>
				<xforms:group
					ref="geneotypingToDistinguishBetweenRecrudescenceAndReinfection">
					<xforms:select1 ref="applicability" appearance="minimal">
						<xforms:label>Was genotyping for recrudescence vs reinfection
							done? </xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-boolean-items')/boolean">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>Please select</xforms:alert>
					</xforms:select1>

					<xforms:group ref="applicable">
						<xforms:group ref="markers">
							<table class="repeat-table">
								<xforms:repeat nodeset="recrudescenceMarker" id="recrudescenceMarker-rep">
									<tr>
										<td class="action-td">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<img src="/apps/common/theme/remove.gif" alt="remove" />
												</xforms:label>
												<xforms:delete ev:event="DOMActivate" context="."
													nodeset="." at="index('recrudescenceMarker-rep')" />
											</xforms:trigger>
										</td>
										<td>
											<xforms:select1 ref="markerName" appearance="minimal">
												<xforms:label>Marker</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-recrudescenceMarker-items')/recrudescenceMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other </xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select1>
											<xforms:input ref="markerOther">
												<xforms:label />
											</xforms:input>
											<xforms:input ref="numberOfMicroSatellites"
												class="fourWide">
												<xforms:label>Number of micro	satellites</xforms:label>
											</xforms:input>
										</td>
									</tr>
								</xforms:repeat>
								<tr>
									<td class="action-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="/apps/common/theme/add.gif" alt="add" />
											</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="."
												nodeset="recrudescenceMarker" at="count(../recrudescenceMarker)"
												position="after" origin="instance('ins-recrudescenceMarker')" />
										</xforms:trigger>
									</td>
									<td class="add-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>Add a marker</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="."
												nodeset="recrudescenceMarker" at="count(../recrudescenceMarker)"
												position="after" origin="instance('ins-recrudescenceMarker')" />
										</xforms:trigger>
									</td>
								</tr>
							</table>
						</xforms:group>


						<xforms:input ref="genotypingLaboratory" class="fixed-Width">
							<xforms:label> Genotyping laboratory </xforms:label>
						</xforms:input>
						<br />
						<xforms:select1 ref="markerDiscriminant"
							appearance="minimal">
							<xforms:label>Method of discrimination</xforms:label>
							<xforms:item>
								<xforms:label>please select</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-markerDiscriminant-items')/markerDiscriminant">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other </xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
							<xforms:alert>Please select a method</xforms:alert>
						</xforms:select1>
						<xforms:input ref="markerDiscriminantOther">
							<xforms:label />
						</xforms:input>

						<xforms:group ref="analysisProtocol">
							<h5>Analysis protocol</h5>

							<xforms:group ref="mixedAllelesOpen">
								<xforms:select1 ref="mixedAlleles" appearance="minimal">
									<xforms:label>Mixed alleles were defined as </xforms:label>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:item>
										<xforms:label>recrudescence</xforms:label>
										<xforms:value>recrudescence</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>reinfection</xforms:label>
										<xforms:value>reinfection</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>other</xforms:label>
										<xforms:value>other</xforms:value>
									</xforms:item>
									<xforms:alert>Please select</xforms:alert>
								</xforms:select1>

								<!-- FIXME: Eclipse complains "xforms:input is not complete" here -->
								<xforms:input ref="mixedAllelesOther"></xforms:input>

								<xforms:select1 ref="recrudescence" appearance="minimal">
									<xforms:label>recrudescence defined as </xforms:label>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:item>
										<xforms:label>old alleles only</xforms:label>
										<xforms:value>old</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>old and new alleles </xforms:label>
										<xforms:value>oldAndNew</xforms:value>
									</xforms:item>
									<xforms:alert>Please select</xforms:alert>
								</xforms:select1>

								<xforms:select1 ref="reinfection" appearance="minimal">
									<xforms:label>reinfection defined as </xforms:label>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:item>
										<xforms:label>new alleles only</xforms:label>
										<xforms:value>new</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>old and new alleles </xforms:label>
										<xforms:value>oldAndNew</xforms:value>
									</xforms:item>
									<xforms:alert>Please select</xforms:alert>
								</xforms:select1>
							</xforms:group>

						</xforms:group>
					</xforms:group>
				</xforms:group>

			</div>

			</xforms:group>

			<xforms:group ref="molecular">

				<div id="molecular-questions-container">

				<h2>Molecular Questions</h2>
				<xforms:group ref="criteria">
					<h3> Sampling and inclusion criteria</h3>
					<xforms:group ref="sampleSourceOpen">
						<xforms:select1 ref="sampleSource" appearance="minimal">
							<xforms:label>Sample source</xforms:label>
							<xforms:item>
								<xforms:label>please select</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-sampleSource-items')/sampleSource">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
							<xforms:alert>Please select</xforms:alert>
						</xforms:select1>
						<xforms:input ref="sampleSourceOther">
							<xforms:label />
						</xforms:input>
					</xforms:group>
					<xforms:select1 ref="malariaStatus" appearance="minimal">
						<xforms:label>Malaria disease status</xforms:label>
						<xforms:item>
							<xforms:label>please select</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-malariaStatus-items')/malariaStatus">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>
							<xforms:output
								value="concat('Enter a value for the required field ', name())" />
						</xforms:alert>
					</xforms:select1>
					<xforms:group ref="sampleSelectionMethodOpen">
						<xforms:select1 ref="sampleSelectionMethod"
							appearance="minimal">
							<xforms:label>Sample selection method</xforms:label>
							<xforms:item>
								<xforms:label>please select</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-sampleSelectionMethod-items')/sampleSelectionMethod">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
							<xforms:alert>
								<xforms:output
									value="concat('Enter a value for the required field ', name())" />
							</xforms:alert>
						</xforms:select1>
						<xforms:input ref="sampleSelectionMethodOther">
							<xforms:label />
						</xforms:input>
						<xforms:input ref="sampleSelectionProportion">
							<xforms:label> proportion </xforms:label>
						</xforms:input>
					</xforms:group>
				</xforms:group>
				<xforms:group ref="sample">
					<h3>Sample type</h3>
					<xforms:group ref="sampleTypeOpen">
						<xforms:select1 ref="sampleType" appearance="minimal">
							<xforms:label>Sample type</xforms:label>
							<xforms:item>
								<xforms:label>please select</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-sampleType-items')/sampleType">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
							<xforms:alert>Please select a value</xforms:alert>
						</xforms:select1>
						<xforms:input ref="sampleTypeOther">
							<xforms:label />
						</xforms:input>
						<xforms:select1 ref="wholeBloodSource" appearance="minimal">
							<xforms:label>Whole blood source</xforms:label>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-wholeBloodSource-items')/wholeBloodSource">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
						<xforms:input ref="dateCultureIsolated">
							<xforms:label>Date samples isolated </xforms:label>
							<xforms:alert>A valid date is required</xforms:alert>
						</xforms:input>
					</xforms:group>
				</xforms:group>


				<xforms:group ref="genotypedMarkers">
					<h3>Resistance Markers</h3>
					<table class="repeat-table">
						<xforms:repeat nodeset="genotypedMarker" id="genotypedMarker-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('genotypedMarker-rep')" />
									</xforms:trigger>
								</td>
								<td>
									<xforms:group ref="genotypingMethodOpen">
										<xforms:select1 ref="genotypingMethod"
											appearance="minimal">
											<xforms:label>Genotyping method</xforms:label>
											<xforms:item>
												<xforms:label>please select</xforms:label>
												<xforms:value />
											</xforms:item>
											<xforms:itemset model="mod-study-info"
												nodeset="instance('ins-genotypingMethod-items')/genotypingMethod">
												<xforms:label ref="label" />
												<xforms:value ref="value" />
											</xforms:itemset>
											<xforms:alert>Please select a method</xforms:alert>
										</xforms:select1>
										<xforms:input ref="genotypingMethodOther">
											<xforms:label />
											<xforms:hint>Other genotyping method</xforms:hint>
										</xforms:input>
									</xforms:group>
									<div class="box">
										<xforms:group ref="molecularMarkerFalciparumOpen">
											<xforms:select ref="molecularMarkerFalciparum"
												appearance="full" class="scrollableCheckboxes">
												<xforms:label class="scrollableCheckboxesLabel">
													Falciparum marker
												</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-molecularMarkerFalciparum-items')/molecularMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select>
											<xforms:input ref="molecularMarkerFalciparumOther">
												<xforms:label />
											</xforms:input>
										</xforms:group>
									</div>
									<div class="box">
										<xforms:group ref="molecularMarkerVivaxOpen">
											<xforms:select ref="molecularMarkerVivax"
												appearance="full" class="scrollableCheckboxes">
												<xforms:label class="scrollableCheckboxesLabel">Vivax
													marker</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-molecularMarkerVivax-items')/molecularMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select>
											<xforms:input ref="molecularMarkerVivaxOther">
												<xforms:label />
											</xforms:input>
										</xforms:group>
									</div>
									<div class="box">

										<xforms:group ref="molecularMarkerOvaleOpen">
											<xforms:select ref="molecularMarkerOvale"
												appearance="full" class="scrollableCheckboxes">
												<xforms:label class="scrollableCheckboxesLabel">Ovale
													marker</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-molecularMarkerOvale-items')/molecularMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select>
											<xforms:input ref="molecularMarkerOvaleOther">
												<xforms:label />
											</xforms:input>
										</xforms:group>
									</div>
									<div class="box">

										<xforms:group ref="molecularMarkerMalariaeOpen">
											<xforms:select ref="molecularMarkerMalariae"
												appearance="full" class="scrollableCheckboxes">
												<xforms:label class="scrollableCheckboxesLabel">Malariae
													marker
												</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-molecularMarkerMalariae-items')/molecularMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select>
											<xforms:input ref="molecularMarkerMalariaeOther">
												<xforms:label />
											</xforms:input>
										</xforms:group>
									</div>

									<div class="box">
										<xforms:group ref="molecularMarkerKnowlesiOpen">
											<xforms:select ref="molecularMarkerKnowlesi"
												appearance="full" class="scrollableCheckboxes">
												<xforms:label class="scrollableCheckboxesLabel">Knowlesi
													marker
												</xforms:label>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-molecularMarkerKnowlesi-items')/molecularMarker">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
											</xforms:select>
											<xforms:input ref="molecularMarkerKnowlesiOther">
												<xforms:label />
											</xforms:input>
										</xforms:group>
									</div>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="genotypedMarker" at="count(../genotypedMarker)"
										position="after" origin="instance('ins-genotypedMarker')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a genotyping method and associated markers
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="genotypedMarker" at="count(../genotypedMarker)"
										position="after" origin="instance('ins-genotypedMarker')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>

				<xforms:group ref="mixedResistanceAlleles">

					<xforms:select1 ref="mixedResistanceAllelesInclusion"
						appearance="minimal">
						<xforms:label>Mixed resistance alleles were </xforms:label>
						<xforms:item>
							<xforms:label>not identified</xforms:label>
							<xforms:value>notIdentified</xforms:value>
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-mixedResistanceAllelesInclusion-items')/mixedResistanceAllelesInclusion">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
					<xforms:select ref="mixedResistanceAllelesDesignation"
						appearance="full">
						<xforms:label>
							<br />
							How were mixed genotype resistance loci designated in the data
							set?
							<br />
						</xforms:label>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-mixedResistanceAllelesDesignation-items')/mixedResistanceAllelesDesignation">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select>
				</xforms:group>

				<xforms:group ref="additionalGenotypicInformation">
					<h3>Additional genetic information</h3>
					<xforms:group ref="sequencedLoci">
						<xforms:select1 ref="wholeGenomesSequenced"
							appearance="minimal">
							<xforms:label>Whole genome(s) sequenced?</xforms:label>
							<xforms:item>
								<xforms:label>please select</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-boolean-items')/boolean">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:alert>Please select a value</xforms:alert>
						</xforms:select1>
						<xforms:group ref="resistanceLoci">
							<h4>Resistance loci</h4>
							<table class="repeat-table">
								<xforms:repeat nodeset="resistanceLocus" id="resistanceLocus-rep">
									<tr>
										<td class="action-td">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<img src="/apps/common/theme/remove.gif" alt="remove" />
												</xforms:label>
												<xforms:delete ev:event="DOMActivate" context="."
													nodeset="." at="index('resistanceLocus-rep')" />
											</xforms:trigger>
										</td>
										<td>
											<xforms:group ref="locusTypeOpen">
												<xforms:select1 ref="locusType" appearance="minimal">
													<xforms:label>Other locus genotyped</xforms:label>
													<xforms:itemset model="mod-study-info"
														nodeset="instance('ins-locusType-items')/locusType">
														<xforms:label ref="label" />
														<xforms:value ref="value" />
													</xforms:itemset>
													<xforms:item>
														<xforms:label>other</xforms:label>
														<xforms:value>other</xforms:value>
													</xforms:item>
												</xforms:select1>
												<xforms:input ref="locusTypeOther">
													<xforms:label />
												</xforms:input>
											</xforms:group>
											<br />
											<xforms:input ref="locusName">
												<xforms:label>Locus name</xforms:label>
											</xforms:input>
										</td>
									</tr>
								</xforms:repeat>
								<tr>
									<td class="action-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="/apps/common/theme/add.gif" alt="add" />
											</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="."
												nodeset="resistanceLocus" at="count(../resistanceLocus)"
												position="after" origin="instance('ins-resistanceLocus')" />
										</xforms:trigger>
									</td>
									<td class="add-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>Add another resistance locus </xforms:label>
											<xforms:insert ev:event="DOMActivate" context="."
												nodeset="resistanceLocus" at="count(../resistanceLocus)"
												position="after" origin="instance('ins-resistanceLocus')" />
										</xforms:trigger>
									</td>
								</tr>
							</table>
						</xforms:group>
					</xforms:group>
					<xforms:select1 ref="infectionComplexityEstimated"
						appearance="minimal">
						<xforms:label>Multiplicity/complexity of infection included?
						</xforms:label>
						<xforms:item>
							<xforms:label>please select</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-boolean-items')/boolean">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
						<xforms:alert>Please select a value</xforms:alert>
					</xforms:select1>
					<xforms:group ref="infectionComplexityEstimationLociOpen">
						<xforms:select ref="infectionComplexityEstimationLoci"
							appearance="full" class="scrollableCheckboxes">
							<xforms:label class="scrollableCheckboxesLabel">loci used to estimate
							</xforms:label>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-resistanceLocus-items')/resistanceLocus">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>
						</xforms:select>
						<div style="clear:both;">
							<xforms:input ref="infectionComplexityEstimationlociOther">
								<xforms:label class="fixed-width">other</xforms:label>
							</xforms:input>
						</div>
					</xforms:group>
					<br style="clear:both;" />
				</xforms:group>

				</div>

			</xforms:group>




			<xforms:group ref="invitro">

				<div id="in-vitro-questions-container">

				<h2>
					<i>in vitro</i>
					Module Questions
				</h2>

				<xforms:input ref="analysisSite">
					<xforms:label>Where did the analysis take place?</xforms:label>
					<xforms:hint>
						<em>Enter a site code, or laboratory name and address if the
							analysis did
							not take place at any of the previously entered
							sites. </em>
					</xforms:hint>
				</xforms:input>
				<!--+
			|
			| BEGIN IN VITRO CULTURE NESTED QUESTIONNAIRE
			|
			+-->
				<xforms:group ref="culture">
					<h4>Culture for Drug Susceptibility Measure</h4>

					<xforms:select1 ref="incubatorSystem" appearance="minimal">
						<xforms:label>Incubator system</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-incubatorSystem-items')/incubatorSystem">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
					<xforms:input model="mod-study-info" ref="co2">
						<xforms:label>
							CO
							<sub>2</sub> percentage
						</xforms:label>
						<xforms:hint>
						5 or 10 percent.
						</xforms:hint>
					</xforms:input>
					<p>
						<xforms:select1 ref="healthyErythrocytesSource"
							appearance="minimal">
							<xforms:label>Healthy erythrocyte source</xforms:label>
							<xforms:item>
								<xforms:label><!-- Nullable -->
								</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-healthyErythrocytesSource-items')/healthyErythrocytesSource">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:hint>
								<em>Healthy erythrocytes have to be deleucocyted.</em>
							</xforms:hint>
						</xforms:select1>
					</p>
					<p>
						<xforms:input ref="hematocrit">
							<xforms:label>Hematocrit (%)</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>
					<p>
						<xforms:select1 ref="bloodGroup" appearance="minimal">
							<xforms:label>Blood group</xforms:label>
							<xforms:item>
								<xforms:label><!-- Nullable -->
								</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-bloodGroup-items')/bloodGroup">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>
				</xforms:group>

				<!--
				+ | | BEGIN IN VITRO MEDIUM NESTED QUESTIONNAIRE | +
			-->

				<xforms:group ref="drugSusceptibilityMedium">
					<h4>Medium for Drug Susceptibility Measure</h4>
					<p>
						<xforms:select1 ref="medium" appearance="minimal">
							<xforms:label>Medium</xforms:label>
							<xforms:item>
								<xforms:label><!-- Nullable -->
								</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-medium-items')/medium">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
							<xforms:item>
								<xforms:label>other</xforms:label>
								<xforms:value>other</xforms:value>
							</xforms:item>

						</xforms:select1>
						<xforms:input ref="mediumOther">
							<xforms:label />
						</xforms:input>
					</p>
					<p>
						<xforms:select1 ref="preparation" appearance="minimal">
							<xforms:label>Preparation</xforms:label>
							<xforms:item>
								<xforms:label><!-- Nullable -->
								</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-mediumPreparation-items')/mediumPreparation">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>
					<p>
						<xforms:select1 ref="serum" appearance="minimal">
							<xforms:label>Serum</xforms:label>
							<xforms:item>
								<xforms:label><!-- Nullable -->
								</xforms:label>
								<xforms:value />
							</xforms:item>
							<xforms:itemset model="mod-study-info"
								nodeset="instance('ins-serum-items')/serum">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>

					<p>
						<xforms:input ref="serum-finalConcentration" class="fourWide">
							<xforms:label>Serum final concentration (g/L) </xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Enter an integer value for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>
					<p>
						<xforms:input ref="NaHCO3-finalConcentration" class="fourWide">
							<xforms:label>
								NaHCO
								<sub>3</sub>
								final concentration (g/L)
							</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Enter an integer value for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>

					<xforms:group ref="hypoxantine">
						<h5>Hypoxantine</h5>
						<p>
							<xforms:select1 ref="hypoxantine-added"
								appearance="minimal">
								<xforms:label>Do you add Hypoxantine?</xforms:label>
								<xforms:itemset model="mod-study-info"
									nodeset="instance('ins-boolean-items')/boolean">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
								<xforms:alert>Please select a value</xforms:alert>
							</xforms:select1>
						</p>
						<p>
							<xforms:input ref="hypoxantine-finalConcentration"
								class="fourWide">
								<xforms:label>Final Hypoxantine concentration (g/L)
								</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Enter an integer value for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
						</p>
					</xforms:group>


					<xforms:group ref="oroticAcid">
						<h5>Orotic Acid</h5>
						<p>
							<xforms:select1 ref="oroticAcid-added" appearance="minimal">
								<xforms:label>Do you add orotic acid?</xforms:label>
								<xforms:itemset model="mod-study-info"
									nodeset="instance('ins-boolean-items')/boolean">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
								<xforms:alert>Please select a value</xforms:alert>
							</xforms:select1>
						</p>
						<p>
							<xforms:input ref="oroticAcid-finalConcentration"
								class="fourWide">
								<xforms:label>Final orotic acid concentration (g/L)
								</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Enter an integer value for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
						</p>
					</xforms:group>

					<xforms:group ref="glucose">
						<h5>Glucose</h5>
						<p>
							<xforms:select1 ref="glucose-added" appearance="minimal">
								<xforms:label>Do you add glucose?</xforms:label>
								<xforms:itemset model="mod-study-info"
									nodeset="instance('ins-boolean-items')/boolean">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
								<xforms:alert>Please select a value</xforms:alert>
							</xforms:select1>
						</p>
						<p>
							<xforms:input ref="glucose-finalConcentration"
								class="fourWide">
								<xforms:label>Final glucose concentration (g/L)</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Enter an integer value for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
						</p>
					</xforms:group>


					<xforms:group ref="antibioticTreatments">
						<p> If you use antibiotics, please fill in the section below for
							each
							antibiotic you use. </p>
						<table class="repeat-table">
							<xforms:repeat nodeset="antibioticTreatment" id="antibioticTreatment-rep">
								<tr>
									<td class="action-td">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="/apps/common/theme/remove.gif" alt="remove" />
											</xforms:label>
											<xforms:delete ev:event="DOMActivate" context="."
												nodeset="." at="index('antibioticTreatment-rep')" />
										</xforms:trigger>
									</td>
									<td>
										<xforms:group ref="antibioticOpen">
											<xforms:select1 ref="antibiotic"
												appearance="minimal">
												<xforms:label>Antibiotic</xforms:label>
												<xforms:item>
													<xforms:label>please select</xforms:label>
													<xforms:value/>
												</xforms:item>
												<xforms:itemset model="mod-study-info"
													nodeset="instance('ins-antibiotic-items')/antibiotic">
													<xforms:label ref="label" />
													<xforms:value ref="value" />
												</xforms:itemset>
												<xforms:item>
													<xforms:label>other</xforms:label>
													<xforms:value>other</xforms:value>
												</xforms:item>
												<xforms:alert>
													<xforms:output
														value="concat('Enter a value for the required field ', name())" />
												</xforms:alert>
											</xforms:select1>
											<xforms:input ref="antibioticOther">
												<xforms:label class="invisible">Other antibiotic
												</xforms:label>
												<xforms:alert>
													<xforms:output
														value="concat('Enter a value for the required field ', name())" />
												</xforms:alert>
											</xforms:input>
										</xforms:group>
										<xforms:input ref="antibioticFinalConcentration"
											class="fourWide">
											<xforms:label>Antibiotic final concentration (g/L)
											</xforms:label>
											<xforms:alert>
												<xforms:output
													value="concat('Enter an integer value for the ', name(), ' field ')" />
											</xforms:alert>
										</xforms:input>
									</td>
								</tr>
							</xforms:repeat>
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/add.gif" alt="add" />
										</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="."
											nodeset="antibioticTreatment" at="count(../antibioticTreatment)" position="after"
											origin="instance('ins-antibioticTreatment')" />
									</xforms:trigger>
								</td>
								<td class="add-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>Add an antibiotic</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="."
											nodeset="antibioticTreatment" at="count(../antibioticTreatment)" position="after"
											origin="instance('ins-antibioticTreatment')" />
									</xforms:trigger>
								</td>
							</tr>
						</table>
					</xforms:group>
				</xforms:group>
				<!--
					+ | | BEGIN IN VITRO SUSCEPTIBILITY NESTED QUESTIONNAIRE | +
				-->


				<xforms:group ref="susceptibility">
					<h4>Determination of drug susceptibility</h4>
					<p>
						<em> If this information is different for each sample, please
							include it in
							your raw data. </em>
					</p>
					<xforms:select1 appearance="minimal" ref="timeOfIncubation">
						<xforms:label class="fixed-width">Time of incubation</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-incubationTime-items')/incubationTime">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
					<br />
					<p>
						<em> If this information is different for each sample, please
							include it in
							your raw data. </em>
					</p>
					<xforms:select1 appearance="minimal" ref="susceptibilityMethod">
						<xforms:label class="fixed-width">Method used</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-info"
							nodeset="instance('ins-susceptibilityMethod-items')/susceptibilityMethod">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</xforms:group>

				<!--
			+ | | END IN VITRO SUSCEPTIBILITY NESTED info | +
		-->


				<!--
					+ | | BEGIN IN VITRO DRUG STOCK SOLUTIONS NESTED QUESTIONNAIRE | +
				-->

				<xforms:group ref="drugs">
					<h4>Drug substances</h4>

					<p>
						<em>Please complete the section below for each drug substance
							used. </em>
					</p>

					<table class="repeat-table">
						<xforms:repeat nodeset="drug" id="drug-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('drug-rep')" />
									</xforms:trigger>
								</td>
								<td>
									<xforms:select1 appearance="minimal" ref="molecule">
										<xforms:label class="fixed-width">Molecule</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-drugMolecule-items')/drugMolecule">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-metaboliteMolecule-items')/metaboliteMolecule">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Select a molecule</xforms:alert>
									</xforms:select1>
									<br />
									<xforms:select1 appearance="minimal" ref="solvent">
										<xforms:label class="fixed-width">Drug substance solvent
										</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-drugSolvent-items')/drugSolvent">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a value</xforms:alert>
									</xforms:select1>
									<br />
									<xforms:input ref="solventFinalConcentration">
										<xforms:label>Solvent final concentration
											(g/L)</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter an integer value for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<br />
									<xforms:select1 appearance="minimal" ref="providedByWwarn">
										<xforms:label>Were drug substances provided by WWARN?
										</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-boolean-items')/boolean">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a value</xforms:alert>
									</xforms:select1>
									<br />
									<xforms:input ref="provider">
										<xforms:label>Who provided the drug?</xforms:label>
									</xforms:input>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="drug" at="count(../drug)" position="after"
										origin="instance('ins-invitro-drug-template')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a drug</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="drug" at="count(../drug)" position="after"
										origin="instance('ins-invitro-drug-template')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>

				<!--
					+ | | END IN VITRO DRUG STOCK SOLUTIONS NESTED QUESTIONNAIRE | +
				-->


				<!--
				+ | | BEGIN IN VITRO PLATES NESTED QUESTIONNAIRE | +
			-->


				<xforms:group ref="plateBatches">
					<h4>Batches of Plates</h4>
					<table class="repeat-table">
						<xforms:repeat nodeset="batch" id="batch-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('batch-rep')" />
									</xforms:trigger>
								</td>
								<td>
									<xforms:select1 appearance="minimal"
										ref="clone3D7ProvidedByWwarn">
										<xforms:label class="fixed-width">Were 3D7 provided by
											WWARN?
										</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-boolean-items')/boolean">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a value</xforms:alert>
									</xforms:select1>
									<br />
									<xforms:input ref="clone3D7Provider">
										<xforms:label>Who provided the clone?</xforms:label>
									</xforms:input>
									<br />
									<xforms:select1 appearance="minimal"
										ref="batchesIncludedInRawData">
										<xforms:label>Are batch preparation dates and 3D7
											information
											included with the raw data?</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-boolean-items')/boolean">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a value</xforms:alert>
									</xforms:select1>
									<xforms:group ref="notIncludedBatchDataHint">
										<p>
											<em>
												If batch preparation dates and 3D7 information are
												<strong>not</strong>
												included with the raw data,
												please complete the section below
												for each batch.
											</em>
										</p>
									</xforms:group>
									<br />
									<xforms:input ref="preparationDate">
										<xforms:label class="fixed-width">Preparation date
										</xforms:label>
									</xforms:input>
									<br />
									<xforms:input ref="parasitaemia3D7">
										<xforms:label class="fixed-width"> 3D7 parasitaemia (%)
										</xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
									<br />
									<xforms:input ref="ringForms">
										<xforms:label class="fixed-width">Ring forms after
											synchronisation (%) </xforms:label>
										<xforms:alert>
											<xforms:output
												value="concat('Enter an integer value between 0 and 100 for the ', name(), ' field ')" />
										</xforms:alert>
									</xforms:input>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="batch" at="count(../batch)" position="after"
										origin="instance('ins-invitro-batch-template')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a Batch</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="batch" at="count(../batch)" position="after"
										origin="instance('ins-invitro-batch-template')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>

				<!--+
			|
			| END IN VITRO PLATES NESTED QUESTIONNAIRE
			|
			+-->

			</div>

			</xforms:group>

			<xforms:group ref="pharmacology">
				
				<div id="pharmacology-questions-container">

				<h2>Pharmacology questions</h2>


				<xforms:group ref="samples">
					<h3>Sample</h3>
					<table class="repeat-table">
						<xforms:repeat nodeset="sample" id="sample-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('sample-rep')" />
									</xforms:trigger>
								</td>
								<td>
									<xforms:input ref="numberPlanned">
										<xforms:label class="fixed-width">Number
											planned</xforms:label>
										<xforms:hint>Total number of samples planned</xforms:hint>
									</xforms:input>
									<br />
									<xforms:input ref="anticoagulent">
										<xforms:label class="fixed-width">Anticoagulent
										</xforms:label>
									</xforms:input>
									<br />
									<xforms:input ref="centrifugeTime">
										<xforms:label class="fixed-width">Time to centrifuge (mins)
										</xforms:label>
										<xforms:hint>eg. &lt; 15 minutes</xforms:hint>
									</xforms:input>
									<xforms:group ref="storage">
										<h4>Temperature and time to storage</h4>
										<xforms:input ref="storageTemperature">
											<xforms:label>Temperature</xforms:label>
											<xforms:hint>Eg room temperature</xforms:hint>
										</xforms:input>
										<xforms:input ref="storageDuration">
											<xforms:label>Duration</xforms:label>
										</xforms:input>
									<xforms:select1 appearance="minimal"
										ref="storageDurationUnit">
										<xforms:label class="invisible">Duration unit</xforms:label>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-storageDurationUnit-items')/storageDurationUnit">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
											<xforms:alert>
												<xforms:output
													value="concat('Enter a value for the ', name(), ' field')" />
											</xforms:alert>
									</xforms:select1>
										
										
									</xforms:group>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="sample" at="count(../sample)" position="after"
										origin="instance('ins-invitro-sample-template')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a sample</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="sample" at="count(../sample)" position="after"
										origin="instance('ins-pharmacology-sample-template')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>



				<xforms:group ref="analytes">
					<h4>
						Drug given and analytes/metabolites measured
						<span style="font-size:smaller; font-weight:normal;">please list all</span>
					</h4>
					<table class="repeat-table">
						<tr>
							<th />
							<th>
								Compound measured
								<br />
								(parent or metabolite)
							</th>
							<th>Lower LoQ</th>
							<th>Matrix</th>
						</tr>
						<xforms:repeat nodeset="analyte" id="analyte-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('analyte-rep')" />
									</xforms:trigger>
								</td>
								<td class="form-td">
									<xforms:select1 appearance="minimal" ref="drugMeasured">
										<xforms:label class="invisible">Molecule measured
										</xforms:label>
										<!-- FIXME: Eclipse complains "invalid content" here -->
										<xforms:hint>Name of drug given or metabolite measured
										</xforms:hint>
										<xforms:item>
											<xforms:label>please select</xforms:label>
											<xforms:value />
										</xforms:item>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-drugMolecule-items')/drugMolecule">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-metaboliteMolecule-items')/metaboliteMolecule">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a molecule</xforms:alert>
									</xforms:select1>

								</td>
								<td class="form-td">
									<xforms:input ref="lowerLoQ" class="fourWide">
										<xforms:label />
										<xforms:hint>Lower limit of quantification</xforms:hint>
									</xforms:input>
								</td>

								<td class="form-td">
									<xforms:select ref="sampleMatrixType" appearance="full">
										<xforms:label />
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-sampleMatrixType-items')/sampleMatrixType">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a matrix</xforms:alert>
										<xforms:hint>The matrix</xforms:hint>
									</xforms:select>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="analyte" at="count(../analyte)" position="after"
										origin="instance('ins-analyte')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add an analyte</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="analyte" at="count(../analyte)" position="after"
										origin="instance('ins-analyte')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>


				<xforms:group ref="assayReferences">
					<h4>Drug assay method reference</h4>
					<table class="repeat-table">
						<tr>
							<th />
							<th>
								Type
							</th>
							<th>
								Reference
							</th>
							<th>
								Validated
							</th>
							<th>
								Notes
							</th>
						</tr>
						<xforms:repeat nodeset="assayReference" id="assayReference-rep">
							<tr>
								<td class="action-td">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="/apps/common/theme/remove.gif" alt="remove" />
										</xforms:label>
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('assayReference-rep')" />
									</xforms:trigger>
								</td>
								<td class="form-td">

									<xforms:select1 appearance="minimal" ref="referenceType">
										<xforms:label class="invisible">Reference type
											</xforms:label>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-referenceType-items')/referenceType">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
										<xforms:alert>Please select a reference type
										</xforms:alert>
									</xforms:select1>
								</td>
								<td class="form-td">

									<xforms:input ref="url">
										<xforms:label class="invisible">Reference URL</xforms:label>
										<xforms:alert>Enter a valid URL</xforms:alert>
										<xforms:send ev:event="xforms-value-changed"
											submission="sub-check-assayReference-url" />
									</xforms:input>
									<xforms:input ref="doi">
										<xforms:label class="invisible">DOI</xforms:label>
										<xforms:hint>Without a DOI: prefix</xforms:hint>
										<xforms:alert>Enter a valid DOI</xforms:alert>
										<xforms:send ev:event="xforms-value-changed"
											submission="sub-check-assayReference-doi" />
									</xforms:input>
									<xforms:group ref="upload">
										<xforms:group
											ref="instance('ins-sq-submitted-media-feed')[empty(atom:entry)]">

											<p>You have not uploaded any documents.</p>

										</xforms:group>

										<xforms:select1 appearance="minimal" ref="uploadedUrl">
											<xforms:label class="invisible">Uploaded document
											</xforms:label>
											<!-- FIXME: Eclipse complains "invalid content" here -->
											<xforms:hint>An uploaded document</xforms:hint>
											<xforms:item>
												<xforms:label>please select</xforms:label>
												<xforms:value />
											</xforms:item>
											<xforms:itemset model="mod-study-info"
												nodeset="xxforms:sort(instance('ins-sq-submitted-media-feed')/atom:entry, atom:published, 'text', 'ascending')">
												<xforms:label>
													<xforms:output value="concat(manta:id, ' - ', atom:title)" />
												</xforms:label>
												<xforms:value ref="atom:link[@rel='edit']/@href" />
											</xforms:itemset>
											<xforms:alert>Please select an uploaded document
											</xforms:alert>
										</xforms:select1>

									</xforms:group>
								</td>
								<td class="form-td">
									<xforms:select1 ref="assayValidated" appearance="minimal">
										<xforms:label class="invisible">Assay validated
										</xforms:label>
										<xforms:itemset model="mod-study-info"
											nodeset="instance('ins-boolean-items')/boolean">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
									</xforms:select1>
								</td>
								<td class="form-td">
									<xforms:textarea ref="note">
										<xforms:label />
										<xforms:hint>Any notes on the assay method.</xforms:hint>
									</xforms:textarea>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td class="action-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/common/theme/add.gif" alt="add" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="assayReference" at="count(../assayReference)"
										position="after" origin="instance('ins-assayReference')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a reference</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="assayReference" at="count(../assayReference)"
										position="after" origin="instance('ins-assayReference')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>

				</div>

			</xforms:group>

		</xforms:group>
	</xforms:group>
</div>

<!--
  Copyright (C) 2010 University of Oxford.
  
  This program is free software; you can redistribute it and/or modify it under the terms of the
  GNU Lesser General Public License as published by the Free Software Foundation; either version
  2.1 of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Lesser General Public License for more details.

  The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
  -->
<?oxygen NVDLSchema="../../../../../oxygen/samples/nvdl/xhtml-xforms-11-orbeon.nvdl"?>
<html 
	xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:f="http://orbeon.org/oxf/xml/formatting" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:manta="http://www.cggh.org/2010/chassis/manta/xmlns"
	xmlns:atombeat="http://purl.org/atombeat/xmlns">
    
    <head>
    
        <title>My studies</title>

		<!-- Needs to be first, due to sequence of xforms-model-construct-done events. -->
        <xi:include href="../common/includes/phrasebook-model.xml"/>
        
        <xforms:model model="mod-my-studies">

        	<!-- non-persistent model for application state -->
        	<xforms:instance id="ins-control">
        		<control xmlns="">
        			<contributor-controls/>
        			<curator-controls/>
        			<administrator-controls/>
        		</control>
        	</xforms:instance>
        	
			<xforms:bind nodeset="instance('ins-control')/contributor-controls" relevant="xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CONTRIBUTOR'"/>
			<xforms:bind nodeset="instance('ins-control')/curator-controls" relevant="xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CURATOR'"/>
			<xforms:bind nodeset="instance('ins-control')/administrator-controls" relevant="xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_ADMINISTRATOR'"/>

        
			<xforms:instance id="ins-study-feed">
				<atom:feed/>
			</xforms:instance>
			
			<xforms:submission 
				id="sub-retrieve-study-feed"
				resource="/atombeat/content/studies"
				method="get"
				replace="instance"
				instance="ins-study-feed"
				serialization="none">
				
        		<!-- error handling -->
				<xforms:setvalue ev:event="xforms-submit" ref="xxforms:instance('ins-phrasebook-control')/resource-action" value="'getting-studies'"/>
				<xi:include href="../common/includes/error-message-actions/submit-error-resource-error.xml"/>
				<xi:include href="../common/includes/error-message-actions/submit-error-non-resource-error.xml"/>
               	
			</xforms:submission>
			
			<xforms:send 
				ev:event="xforms-model-construct-done" 
				submission="sub-retrieve-study-feed"/>
				
    		
			
        </xforms:model>

       	<xi:include href="../common/includes/current-user-model.xml"/>

    </head>
    <body>

		<!-- Body header -->
                <div id="header" class="header">
					<h1 class="logo"><a href="/" target="_blank" f:url-norewrite="true">WWARN - Worldwide Antimalarial Resistance Network</a></h1>

							    <div id="block-menu-primary-links">
								    <ul id="primary" class="clearfix">
								    	<li class="{if (not(xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CONTRIBUTOR')) then 'hidden-tab' else ''}"><a href="/contributor/home">Data Home</a></li>
								    	<li class="{if (not(xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CURATOR')) then 'hidden-tab' else ''}"><a href="/curator/home">Curator Home</a></li>
								    	<li class="{if (not(xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CONTRIBUTOR')) then 'hidden-tab' else ''}"><a href="/contributor/register-study-wizard">Register Study</a></li>
								    	<li class="active-trail {if (not(xxforms:instance('ins-current-user')//role = 'ROLE_CHASSIS_CONTRIBUTOR')) then 'hidden-tab' else ''}"><a href="/contributor/my-studies">My Studies</a></li>
								    	<li><a href="/" f:url-norewrite="true" target="_blank">WWARN Website</a></li>
								    </ul>
							    </div>
					
					<div class="secondary-wrap">
						<xi:include href="../common/includes/current-user-actions.xml"/>
					</div>
				</div>
		<!-- End of Body header -->

		<!-- After body header, before content id -->
                <div id="holdall">
                	<div id="main-inner">
                		<div class="content page">
		                	<div id="bd" class="clearfix">

								<div class="help">
						
									<p>Any study you register or have permission to access will be listed here. Navigate to individual studies to upload files or edit the information provided when you registered the study.
									</p>
								
								</div>   		                	
		                	
				                <div class="no-bg">
				                	<div class="main twoCol">
		<!-- End of After body header, before content id -->



		<div id="content" class="home">
    
			<xi:include href="includes/my-studies-table.xml"/>

    	</div>

                		
  
    	
    	<!-- After content id, before ft id -->
				                	</div>
				                </div>
		                	</div>

		                	<div class="background">
		                	
								
		                	
		                	</div>
		                	
                		</div>
                	</div>
                </div>

		<!-- End of After content id, before ft id -->

    </body>
</html>


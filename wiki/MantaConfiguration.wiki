#summary Setup Chassis on a VirtuaBox VM
#labels Phase-Deploy

Setup a VirtualBox VM using Ubuntu 
  attach a second, host only adapter 
  Install - select Tomcat and Lamp
  

Add to /etc/hosts on host machine
{{{
192.168.56.20	chassis
}}}
apt-get install emacs

On vm add to /etc/network/interfaces
{{{
auto eth1
iface eth1 inet static
        address 192.168.56.20
        netmask 255.255.255.0
}}}
{{{
sudo apt-get install-openssh-server

/etc/init.d/networking restart
}}}
You should now be able to ssh into the VM, no need to use the VirtualBox window.

You should now be able to see 'It works!' on http://chassis/
{{{
sudo a2enmod proxy
sudo a2enmod proxy_httpd
}}}
Update /etc /apache2/available-sites/default 
{{{
ProxyPass /repository http://localhost:8080/repository
ProxyPassReverse /repository http://localhost:8080/repository
<Proxy http://localhost:8080/repository*>
Order deny,allow
Allow from all
</Proxy>
}}}
{{{
sudo /etc/init.d/apache2 restart
sudo apt-get install maven2
sudo apt-get install subversion
sudo apt-get install openjdk-6-jdk
}}}

ssh into vm as non-privileged user
{{{
ssh chassis
mkdir workspace
cd workspace
svn checkout https://dsn-chassis.googlecode.com/svn/branches/manta-maven/manta-webapp --username Tim.pizey@gmail.com
cd manta-webapp
mvn install 
cd ..
svn checkout https://dsn-chassis.googlecode.com/svn/trunk/manta-config --username Tim.pizey@gmail.com
cd manta-config
mvn install

sudo mkdir /usr/share/tomcat6/endorsed
sudo cp target/manta-config-0.2-alpha-5-SNAPSHOT.jar /usr/share/tomcat6/endorsed/
# Not really needed yet
sudo cp ~/.m2/repository/mysql/mysql-connector-java/5.1.6/mysql-connector-java-5.1.6.jar /usr/share/tomcat6/endorsed/

sudo emacs /etc/tomcat6/server.xml
}}}
To GlobalNamingResources add
{{{
 <Resource auth="Container" factory="org.apache.naming.factory.BeanFactory" name="bean/existConfigFactory" type="org.cggh.chassis.manta.util.config.ExistConfig" username="admin" password=""
       serviceBaseURL="http://localhost:8080/repository/service"/>
}}}


Create file /srv/chassis-manta/context/repository.xml with the following contents: 
{{{
<?xml version="1.0" encoding="UTF-8"?>
<Context path="/repository" reloadable="true">
   <ResourceLink global="bean/existConfigFactory" name="bean/existConfigFactory"
        type="org.cggh.chassis.manta.util.config.ExistConfig"/>
    <Environment name="smtp-user" type="java.lang.String" value="curation@wwarn.org"/>
    <Environment name="smtp-password" type="java.lang.String" value="ma1ar1a"/>
    <Environment name="smtp-from-email" type="java.lang.String" value="curation@wwarn.org"/>
    <Environment name="smtp-from-name" type="java.lang.String" value="Curator (timp_chassis_vm)"/>
</Context>
}}}
{{{
sudo chown tomcat6:tomcat6

sudo emacs /etc/tomcat6/tomcat-users.xml 
add 
}}}
{{{
<user username="admin" password="" roles="manager,admin" />
}}}
{{{
sudo mkdir /data
sudo mkdir /data/atombeat
sudo chown tomcat6:tomcat6
sudo /etc/init.d/tomcat6 restart
cd ~/workspace/manta-webapp/
mvn tomcat:deploy
}}}
Point browser at http://chassis:8080/repository/home/ and have a cuppa!


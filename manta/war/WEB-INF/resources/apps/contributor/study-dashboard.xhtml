<!--
  Copyright (C) 2010 University of Oxford.
  
  This program is free software; you can redistribute it and/or modify it under the terms of the
  GNU Lesser General Public License as published by the Free Software Foundation; either version
  2.1 of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Lesser General Public License for more details.

  The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
  -->
<html 
	xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:f="http://orbeon.org/oxf/xml/formatting" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:manta="http://www.cggh.org/2010/chassis/manta/xmlns"
    xmlns:atombeat="http://purl.org/atombeat/xmlns"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xxi="http://orbeon.org/oxf/xml/xinclude">
    
    <head>
        <title>Manta Data Management - Submitter - Study <xforms:output value="instance('ins-study-entry')/manta:id"/> - Summary</title>
        <link rel="stylesheet" type="text/css" href="/apps/submitter/common/style.css"></link>
        <link rel="stylesheet" type="text/css" href="/ops/yui/tabview/assets/skins/sam/tabview.css"></link>
        <style type="text/css"></style>
        
        <xforms:model>
        
        	<!-- non-persistent model for application state -->
        	<xforms:instance id="ins-control">
        		<control xmlns="">
        			<!-- Defaults to summary if there is no tab request-paramater, determined in the setvalue logic below. -->
        			<current-dashboard-tab />
        			<add-publication-trigger/>
        		</control>
        	</xforms:instance>
        	
        	<xforms:setvalue ev:event="xforms-model-construct-done" ref="instance('ins-control')/current-dashboard-tab" value="if(not(empty(xxforms:get-request-parameter('tab')))) then xxforms:get-request-parameter('tab') else 'summary'" />

			<xforms:bind nodeset="instance('ins-control')/add-publication-trigger" relevant="instance('ins-study-entry')/atom:content/study/study-is-published='true'"/>
        
        
			<xforms:instance id="ins-study-entry">
				<atom:entry/>
			</xforms:instance>
			
			<xforms:submission 
				id="sub-get-study-entry"
				action="{xxforms:get-request-parameter('study')}"
				method="get"
				replace="instance"
				instance="ins-study-entry"
				ref="instance('ins-noparams')">
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('error-type')"/>) while retrieving the study.</xforms:message>
				<xforms:send ev:event="xforms-submit-done" submission="sub-get-permissions-entry"/>
			</xforms:submission>

			<xforms:send ev:event="xforms-model-construct-done" submission="sub-get-study-entry"/>

        	<xforms:instance id="ins-noparams">
        		<params xmlns=""/>
        	</xforms:instance>
        	
		    <xforms:submission
		        id="sub-put-study-entry"
		        resource="{instance('ins-study-entry')/atom:link[@rel='edit']/@href}"
		        method="put"
		        replace="instance"
		        instance="ins-study-entry"
		        ref="instance('ins-study-entry')"
		        mediatype="application/atom+xml">
		        <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('error-type')"/>) while saving the study.</xforms:message>
		        <xforms:message ev:event="xforms-submit-done" level="modal">Your changes have been saved.</xforms:message>
		    </xforms:submission>
        	
        	
            
            
            
			<xforms:instance id="ins-permissions-entry">
				<atom:entry/>
			</xforms:instance> 
            
			<xforms:submission 
				id="sub-get-permissions-entry"
				action="{instance('ins-study-entry')/atom:link[@rel='http://purl.org/atombeat/rel/security-descriptor']/@href}"
				method="get"
				replace="instance"
				instance="ins-permissions-entry"
				ref="instance('ins-noparams')">
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('error-type')"/>) while retrieving the study.</xforms:message>
                <xforms:send ev:event="xforms-submit-done" submission="sub-get-submitted-media-feed"/>
			</xforms:submission>   
            
			<xforms:submission 
				id="sub-put-permissions-entry"
				action="{instance('ins-study-entry')/atom:link[@rel='http://purl.org/atombeat/rel/security-descriptor']/@href}"
				method="put"
				replace="instance"
				instance="ins-permissions-entry"
				ref="instance('ins-permissions-entry')"
				mediatype="application/atom+xml">
		        <xforms:message ev:event="xforms-submit-done" level="modal">Your changes have been saved, thank you.</xforms:message>
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('error-type')"/>) while retrieving the study.</xforms:message>
			</xforms:submission>
            
       		<xforms:instance id="ins-user-template">
       			<atombeat:member/>
  			</xforms:instance>
  			
  			
  			<xforms:instance id="ins-person-template" src="/apps/common/templates/study/person-template.xml"/>
  			
  			
  			<xforms:instance id="ins-publication-template" src="/apps/common/templates/study/publication-template.xml"/>
  			
        	<xforms:bind nodeset="instance('ins-study-entry')/atom:content/study/publications">

			        <xforms:bind nodeset="publication" relevant="instance('ins-study-entry')/atom:content/study/study-is-published='true'">
			            
			            <xforms:bind nodeset="title" required="true()"/>
			            <xforms:bind nodeset="first-author" required="true()"/>
			            <xforms:bind nodeset="status" required="true()"/>
			            <xforms:bind nodeset="year"/>
			            <xforms:bind nodeset="journal"/>
			            <xforms:bind nodeset="url"/>
			            <xforms:bind nodeset="doi"/>
			            <xforms:bind nodeset="pubmed-id"/>
			            
			        </xforms:bind>
			        
       		</xforms:bind>       
            

			<xforms:instance id="ins-upload-template">
				<upload
					xmlns=""
					filename=""
					mediatype=""
					size=""
					typeterm=""
					typelabel=""
					xsi:type="xs:anyURI"></upload>
			</xforms:instance>

			<xforms:instance id="ins-uploads-entry">
					<xi:include href="/apps/contributor/includes/uploads-entry-template.xml" xxi:omit-xml-base="true"/>
        	</xforms:instance> 


			<xforms:instance id="ins-submitted-media-feed">
				<atom:feed/>
			</xforms:instance>
			
			<xforms:submission
				id="sub-get-submitted-media-feed"
				action="{instance('ins-study-entry')/atom:link[@rel='http://www.cggh.org/2010/chassis/terms/submittedMedia']/@href}"
				method="get"
				replace="instance"
				instance="ins-submitted-media-feed">
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('error-type')"/>) while retrieving the submitted media.</xforms:message>
			</xforms:submission>
            
            
        </xforms:model>
        
       	<!-- <xi:include href="/apps/common/includes/current-user-xforms-model.xml"/>  -->
        
    </head>
    <body>
		<!--  <xi:include href="/apps/common/includes/current-user-actions.xml"/> -->

		<h1>Study Dashboard</h1>

		<br/>
		
    		<div class="yui-navset yui-navset-top">
    			<ul class="yui-nav">
    				<xforms:group ref="instance('ins-control')[current-dashboard-tab='summary']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=summary&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
	    						<em>Summary</em>
	   						</a>
	    				</li>
	    			</xforms:group>
    				<xforms:group ref="instance('ins-control')[current-dashboard-tab!='summary']">
	    				<li>
	    					<a href="study-dashboard?tab=summary&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
	    						<em>Summary</em>
	   						</a>
	    				</li>
	    			</xforms:group>
	    			
	    			<xforms:group ref="instance('ins-control')[current-dashboard-tab='permissions']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=permissions&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Permissions</em>
	    					</a>
	   					</li>
   					</xforms:group>
	    			<xforms:group ref="instance('ins-control')[current-dashboard-tab!='permissions']">
	    				<li>
	    					<a href="study-dashboard?tab=permissions&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Permissions</em>
	    					</a>
	   					</li>
   					</xforms:group>
   					
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab='acknowledgements']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=acknowledgements&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Acknowledgements</em>
	    					</a>
	   					</li>
   					</xforms:group>
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab!='acknowledgements']">
	    				<li>
	    					<a href="study-dashboard?tab=acknowledgements&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Acknowledgements</em>
	    					</a>
	   					</li>
   					</xforms:group>
   					
   					
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab='files']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=files&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Files</em>
	    					</a>
	   					</li>
   					</xforms:group>
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab!='files']">
	    				<li>
	    					<a href="study-dashboard?tab=files&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Files</em>
	    					</a>
	   					</li>
   					</xforms:group>
   					
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab='publications']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=publications&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Publications</em>
	    					</a>
	   					</li>
	   				</xforms:group>
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab!='publications']">
	    				<li>
	    					<a href="study-dashboard?tab=publications&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Publications</em>
	    					</a>
	   					</li>
	   				</xforms:group>
   					
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab='study-info']">
	    				<li class="selected">
	    					<a href="study-dashboard?tab=study-info&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Study Info</em>
	    					</a>
	   					</li>
					</xforms:group>
   					<xforms:group ref="instance('ins-control')[current-dashboard-tab!='study-info']">
	    				<li>
	    					<a href="study-dashboard?tab=study-info&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
		    					<em>Study Info</em>
	    					</a>
	   					</li>
					</xforms:group>


    			</ul>
    			
    			<div class="yui-content">
    			
				   	<div class="inner-help">
				   	
				    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='summary']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/summary.xml"/>
				    	</xforms:group>
				    	
				    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='permissions']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/permissions.xml"/>
				    	</xforms:group>
				    	
				    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='acknowledgements']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/acknowledgements.xml"/>
				    	</xforms:group>
				    	
						<xforms:group ref="instance('ins-control')[current-dashboard-tab='files']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/files.xml"/>
				    	</xforms:group>
				    	
				    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='publications']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/publications.xml"/>
				    	</xforms:group>
				    	
						<xforms:group ref="instance('ins-control')[current-dashboard-tab='study-info']">
				    		<xi:include href="/apps/contributor/includes/help-boxes/for-dashboard-tabs/study-info.xml"/>
				    	</xforms:group>
				    	
				   	</div>
				   	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='summary']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/summary.xml"/>
			    	</xforms:group>		
			    	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='permissions']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/permissions.xml"/>
			    	</xforms:group>	
			    	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='acknowledgements']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/acknowledgements.xml"/>
			    	</xforms:group>	
			    	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='files']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/files.xml"/>
			    	</xforms:group>	
			    	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='publications']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/publications.xml"/>
			    	</xforms:group>			 
			    	
			    	<xforms:group ref="instance('ins-control')[current-dashboard-tab='study-info']">
			    		<xi:include href="/apps/contributor/includes/dashboard-tabs/study-info.xml"/>
			    	</xforms:group>	

    			</div>
    			
    		</div>
    		
    </body>
</html>


<div 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:xforms="http://www.w3.org/2002/xforms" 
	xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms">

	<h2>(4) Upload Files</h2>
	
		                    	
		<xforms:group ref="instance('ins-submitted-media-feed')">
		
			<h3>Uploaded Files</h3>
		
	    	<fr:datatable>
	    		<thead>
	    			<tr>
	    				<th>Code</th>
	    				<th>File Name</th>
	    				<th>Date Submitted</th>
	    				<th>Type</th>
	    				<th>Actions</th>
	    			</tr>
	    		</thead>
	    		<tbody>
	    			<xforms:repeat nodeset="instance('ins-submitted-media-feed')/atom:entry">
	    				<tr>
	    					<td>
	    						<xforms:output ref="manta:id"/>
	    					</td>
	    					<td>
	    						<xforms:output ref="atom:title"/>
	    					</td>
							<td>
	    						TODO: Type
	    					</td>
	    					<td>
	    						<xforms:output ref="atom:published" xxforms:format="format-dateTime(., '[Y0001]-[M01]-[D01]')"/>
	    					</td>
	    					<td><a href="{atom:content/@src}">Download</a></td>
	    				</tr>
	    			</xforms:repeat>
	    		</tbody>
	    	</fr:datatable>		
	    	
		</xforms:group>
					
					
							
			<table>

				<xforms:group ref="instance('ins-draft-entry')/atom:content/draft/background-uploads-container/uploads">
					<xforms:repeat nodeset="upload" id="rep-upload">
						<tr>
							<td>
		                        <xforms:trigger>
		                            <xforms:delete 
		                            	ev:event="DOMActivate" 
			                        	context="instance('ins-draft-entry')/atom:content/draft/background-uploads-container/uploads" 
			                        	nodeset="upload" 
		                            	at="index('rep-upload')"/>
		                            <xforms:label><img src="/apps/submitter/common/remove.gif"/></xforms:label>
		                        </xforms:trigger>
							</td>
							<td>
		                        
		                        <xforms:upload ref=".">
		                        	<xforms:label>File:</xforms:label>
		                            <xforms:filename ref="@filename"/>
		                            <xforms:mediatype ref="@mediatype"/>
		                            <xxforms:size ref="@size"/>
		                            <xforms:send ev:event="xforms-select" submission="sub-background-upload"/>
		                        </xforms:upload>
		                        
		                        <br/>
								<xforms:select1 ref="@typeterm">
									<xforms:label>Type:</xforms:label>
									<xforms:alert>Please select a file type.</xforms:alert>
									<xforms:item>
										<xforms:value></xforms:value>
										<xforms:label>Select...</xforms:label>
									</xforms:item>
		                        	<xforms:itemset nodeset="instance('ins-file-terms')/term">
		                        		<xforms:label ref="label"/>
		                        		<xforms:value ref="value"/>
		                        	</xforms:itemset>
								</xforms:select1>
								
								<xforms:input ref="@typelabel">
									<xforms:label>Other Type:</xforms:label>
								</xforms:input>
		                        
							</td>
						</tr>
					</xforms:repeat>
				</xforms:group>
				
				<tr>
					<td>
	                    <xforms:trigger>
	                        <xforms:label><img src="/apps/submitter/common/add.gif"/></xforms:label>
	                        <xforms:insert 
	                        	ev:event="DOMActivate" 
	                        	context="instance('ins-draft-entry')/atom:content/draft/background-uploads-container/uploads" 
	                        	nodeset="upload" 
	                        	at="last()" 
	                        	position="after" 
	                        	origin="instance('ins-upload-template')"/>
	                    </xforms:trigger>
					</td>
					<td >
	                    <xforms:trigger appearance="minimal">
	                        <xforms:label>Add a File</xforms:label>
	                        <xforms:insert 
	                        	ev:event="DOMActivate" 
	                        	context="instance('ins-draft-entry')/atom:content/draft/background-uploads-container/uploads" 
	                        	nodeset="upload" 
	                        	at="last()" 
	                        	position="after" 
	                        	origin="instance('ins-upload-template')"/>
	                    </xforms:trigger>
					</td>
				</tr>
			</table>
			
		

		<!-- groups on instance('ins-draft-entry')/atom:content/draft/background-uploads-container/uploads/upload and not() don't work 
		somehow both are always relevant.-->

			<p>
				<xforms:trigger ref="instance('ins-control')/save-trigger">
					<xforms:label>&lt; Previous</xforms:label>
					<xforms:action ev:event="DOMActivate">
						<xforms:setvalue ref="instance('ins-control')/fallback-wizard-pane" value="'upload-files'"/>
						<xforms:setvalue ref="instance('ins-draft-entry')/atom:content/draft/wizard-pane" value="'acknowledgements'"/>
						<xforms:send submission="sub-upload-files"/>
					</xforms:action>
				</xforms:trigger>
		
				<xforms:trigger ref="instance('ins-control')/save-trigger">
					<xforms:label>Save As Draft</xforms:label>
					<xforms:action ev:event="DOMActivate">
						<xforms:setvalue ref="instance('ins-control')/fallback-wizard-pane" value="'upload-files'"/>
						<xforms:send submission="sub-upload-files"/>
					</xforms:action>
				</xforms:trigger>
		
				<xforms:trigger ref="instance('ins-control')/save-trigger">
					<xforms:label>Next &gt;</xforms:label>
					<xforms:action ev:event="DOMActivate">
						<xforms:setvalue ref="instance('ins-control')/fallback-wizard-pane" value="'upload-files'"/>
						<xforms:setvalue ref="instance('ins-draft-entry')/atom:content/draft/wizard-pane" value="'publications'"/>
						<xforms:send submission="sub-upload-files"/>
					</xforms:action>
				</xforms:trigger>
		
				<xforms:trigger ref="instance('ins-control')/save-trigger" appearance="minimal">
					<xforms:label>Skip To End &gt;&gt;</xforms:label>
					<xforms:action ev:event="DOMActivate">
						<xforms:setvalue ref="instance('ins-control')/fallback-wizard-pane" value="'upload-files'"/>
						<xforms:setvalue ref="instance('ins-draft-entry')/atom:content/draft/wizard-pane" value="'review'"/>
						<xforms:send submission="sub-upload-files"/>
					</xforms:action>
				</xforms:trigger>
				
			</p>
		
</div>
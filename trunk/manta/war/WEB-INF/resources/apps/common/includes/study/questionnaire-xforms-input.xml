<div xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:f="http://orbeon.org/oxf/xml/formatting"
	xmlns="http://www.w3.org/1999/xhtml" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:atom="http://www.w3.org/2005/Atom" xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
	xmlns:ctype="http://www.cggh.org/chassis-types" xmlns:xi="http://www.w3.org/2001/XInclude">

	<xforms:group model="mod-study-questionnaire"
		ref="instance('ins-sq-study-entry')/atom:content/study">

		<p>
			<xforms:submit submission="sub-put-study-entry">
				<xforms:label>Save Changes</xforms:label>
			</xforms:submit>
		</p>

		<h2>General Questions</h2>

		<h3>Study Type (WWARN Modules)</h3>

		<p>
			<xforms:select ref="modules" appearance="full">
				<xforms:label>
					Please select the WWARN modules for which this study has data.
					<br />
				</xforms:label>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-module-items')/module">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select>
		</p>

		<h3>Study Start and End</h3>

		<p>
			<xforms:input ref="start">
				<xforms:label class="fixed-width">Start: </xforms:label>
				<xforms:alert>A valid date is required.</xforms:alert>
			</xforms:input>
		</p>

		<p>
			<xforms:input ref="end">
				<xforms:label class="fixed-width">End: </xforms:label>
				<xforms:alert>A valid date is required.</xforms:alert>
			</xforms:input>
		</p>

		<h3>Pathogen Species</h3>

		<p>
			<xforms:select ref="pathogens" appearance="full">
				<xforms:label />
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-pathogen-items')/pathogen">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select>
		</p>


		<xforms:group ref="sites">
			<h3>Study Site(s)</h3>
			<table class="repeat-table">
				<xforms:repeat nodeset="site" id="rep-site">
					<tr>
						<td>
							<xforms:trigger appearance="minimal">
								<xforms:delete ev:event="DOMActivate" context="."
									nodeset="." at="index('rep-site')" />
								<xforms:label>
									<img src="/apps/submitter/common/remove.gif" />
								</xforms:label>
							</xforms:trigger>
						</td>
						<td class="form-td">
							<xforms:select1 ref="country" required="true()">
								<xforms:alert>Please select a Country value</xforms:alert>
								<xforms:label />
								<xforms:item>
									<xforms:label>please select</xforms:label>
									<xforms:value />
								</xforms:item>
								<xforms:itemset nodeset="instance('ins-country-items')/country">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
							</xforms:select1>
							<br />
							<!-- if the country has regions, use a select1 -->
							<xforms:group
								ref=".[country/text() = instance('ins-country-items')/country[exists(regions)]/value/text()]">

								<xforms:select1 ref="region">
									<xforms:label class="fixed-width">Region: </xforms:label>
									<xforms:itemset
										nodeset="instance('ins-country-items')/country[value/text()=xxforms:context('rep-site')/country/text()]//region">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
								</xforms:select1>

							</xforms:group>

							<!--  TODO Add percentage validation?? -->

							<!-- if the country has no regions, use an input -->
							<xforms:group
								ref=".[empty(country/text()) or country/text() = instance('ins-country-items')/country[empty(regions)]/value/text()]">
								<xforms:input ref="region">
									<xforms:label class="fixed-width">Region: </xforms:label>
								</xforms:input>

							</xforms:group>

							<br />

							<xforms:input ref="district">
								<xforms:label class="fixed-width">District: </xforms:label>
							</xforms:input>
							<br />

							<xforms:input ref="locality">
								<xforms:label class="fixed-width">Locality: </xforms:label>
							</xforms:input>
							<br />

							<xforms:input ref="siteCode">
								<xforms:label class="fixed-width">Your site code:</xforms:label>
							</xforms:input>
							<br />

							<xforms:select1 appearance="minimal" ref="testingDelay">
								<xforms:label class="fixed-width">Sampling/testing delay:
								</xforms:label>
								<xforms:item>
									<xforms:label><!-- Nullable -->
									</xforms:label>
									<xforms:value />
								</xforms:item>
								<xforms:itemset model="mod-study-questionnaire"
									nodeset="instance('ins-testingDelay-items')/testingDelay">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
							</xforms:select1>
							<br />

							<xforms:select1 appearance="minimal" ref="anticoagulant">
								<xforms:label class="fixed-width">Anticoagulant:</xforms:label>
								<xforms:item>
									<xforms:label><!-- Nullable -->
									</xforms:label>
									<xforms:value />
								</xforms:item>
								<xforms:itemset model="mod-study-questionnaire"
									nodeset="instance('ins-anticoagulant-items')/anticoagulant">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
							</xforms:select1>

							<br />

							<xforms:select1 appearance="minimal"
								ref="transportAndStorageTemperature">
								<xforms:label class="fixed-width">Transport/storage temperature:
								</xforms:label>
								<xforms:item>
									<xforms:label><!-- Nullable -->
									</xforms:label>
									<xforms:value />
								</xforms:item>
								<xforms:itemset model="mod-study-questionnaire"
									nodeset="instance('ins-transportAndStorageTemperature-items')/transportAndStorageTemperature">
									<xforms:label ref="label" />
									<xforms:value ref="value" />
								</xforms:itemset>
							</xforms:select1>


							<br />
							<xforms:input ref="latitude">
								<xforms:label class="fixed-width">Latitude:</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Please enter a coordinate value between -180  and 180 for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
							<br />
							<xforms:input ref="longitude">
								<xforms:label class="fixed-width">Longtude:</xforms:label>
								<xforms:alert>
									<xforms:output
										value="concat('Please enter a coordinate value between -180 and 180 for the ', name(), ' field ')" />
								</xforms:alert>
							</xforms:input>
						</td>
					</tr>
				</xforms:repeat>
				<tr>
					<td>
						<xforms:trigger appearance="minimal">
							<xforms:label>
								<img src="/apps/submitter/common/add.gif" />
							</xforms:label>
							<xforms:insert ev:event="DOMActivate" context="."
								nodeset="site" at="count(../site)" position="after"
								origin="instance('ins-site-template')" />
						</xforms:trigger>
					</td>
					<td class="add-td">
						<xforms:trigger appearance="minimal">
							<xforms:label>Add a Site</xforms:label>
							<xforms:insert ev:event="DOMActivate" context="."
								nodeset="site" at="count(../site)" position="after"
								origin="instance('ins-site-template')" />
						</xforms:trigger>
					</td>
				</tr>
			</table>
		</xforms:group>

		<xforms:group ref="transmissionIntensity">
			<h3>Transmission Intensity</h3>



			<xforms:input ref="annualParasitologicalIncidence"
				class="fourWide">
				<xforms:label class="fixed-width">Annual
					Parasitological Incidence
					(API)</xforms:label>
			</xforms:input>
			<xforms:input ref="annualParasitologicalIncidenceYear"
				class="fourWide">
				<xforms:label>in year </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter a recent year for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<br />
			<xforms:input ref="parasitePrevalence" class="fourWide">
				<xforms:label class="fixed-width">Parasite Prevalence</xforms:label>
			</xforms:input>
			<xforms:input ref="parasitePrevalenceYear" class="fourWide">
				<xforms:label>in year </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter a recent year for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<br />
			<xforms:input ref="transmissionIntensityAgeFrom" class="fourWide">
				<xforms:label class="fixed-width">API derived from age </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter an age in years for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>

			<xforms:input ref="transmissionIntensityAgeTo" class="fourWide">
				<xforms:label>to </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter an age in years for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<br />
			<xforms:input ref="entomologicalInoculationRate" class="fourWide">
				<xforms:label class="fixed-width">Entomological Inoculation Rate
					(EIR)</xforms:label>
				<xforms:hint>Infective bites per person per year (ib/p/year)
				</xforms:hint>
			</xforms:input>
			<xforms:input ref="entomologicalInoculationRateYear"
				width="4" class="fourWide">
				<xforms:label>in year </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter a recent year for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<br />
			<xforms:select1 ref="seasonalTransmission" appearance="minimal">
				<xforms:label class="fixed-width">Is transmission seasonal?
				</xforms:label>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-boolean-items')/boolean">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select1>

			<xforms:select ref="transmissionMonths" appearance="compact">
				<xforms:label>Select months</xforms:label>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-month-items')/month">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select>

		</xforms:group>

		<xforms:group ref="inclusionExclusionCriteria">
			<h3 id="inclusionExclusionCriteria">Inclusion/Exclusion Criteria</h3>

			<xforms:input ref="minAge" class="fourWide">
				<xforms:label class="fixed-wdith">Age min </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter an age in years for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<xforms:input ref="maxAge" class="fourWide">
				<xforms:label>max </xforms:label>
				<xforms:alert>
					<xforms:output
						value="concat('Please enter an age in years for the ', name(), ' field ')" />
				</xforms:alert>
			</xforms:input>
			<br />
			<xforms:input ref="minParasitaemia" class="fourWide">
				<xforms:label class="fixed-width">Parasitaemia min
				</xforms:label>
				<xforms:hint>Asexual parasites/µL</xforms:hint>
			</xforms:input>

			<xforms:input ref="maxParasitaemia" class="fourWide">
				<xforms:label>max </xforms:label>
				<xforms:hint>Asexual parasites/µL</xforms:hint>
			</xforms:input>
			<br />
			<xforms:select1 ref="excludeIfPriorAntimalarials"
				appearance="minimal">
				<xforms:label class="fixed-width">Exclude if prior anti-malarials?
				</xforms:label>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-boolean-items')/boolean">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select1>
			<br />
			<xforms:select1 ref="priorAntimalarials" appearance="minimal">
				<xforms:label class="fixed-width">Prior anti-malarials</xforms:label>
				<xforms:item>
					<xforms:label>Any</xforms:label>
					<xforms:value>any</xforms:value>
				</xforms:item>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-drugMolecule-items')/drugMolecule">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select1>
			<br />
			<xforms:select1 ref="priorAntimalarialsDetermination"
				appearance="minimal">
				<xforms:label class="fixed-width">How were prior treatments
					determined?</xforms:label>
				<xforms:itemset model="mod-study-questionnaire"
					nodeset="instance('ins-priorAntimalarialsDetermination-items')/priorAntimalarialsDetermination">
					<xforms:label ref="label" />
					<xforms:value ref="value" />
				</xforms:itemset>
			</xforms:select1>

			<xforms:input ref="priorAntimalarialsHistoryWeeks">
				<xforms:label>Number of weeks </xforms:label>
			</xforms:input>

		</xforms:group>


		<p>
			<xforms:submit submission="sub-put-study-entry">
				<xforms:label>Save Changes</xforms:label>
			</xforms:submit>
		</p>

		<xforms:group ref="clinical">
			<h2>Clinical Questions</h2>

			<h3>Treatments</h3>
			<xforms:group ref="treatment">
				<xforms:group ref="regimens">
					<h5>Regimen</h5>
					<table class="repeat-table">
						<xforms:repeat nodeset="regimen" id="rep-regimen">
							<tr>
								<td>
									<xforms:trigger appearance="minimal">
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('rep-regimen')" />
										<xforms:label>
											<img src="/apps/submitter/common/remove.gif" />
										</xforms:label>
									</xforms:trigger>
								</td>
								<td class="form-td">
									<xforms:input ref="regimenName">
										<xforms:label class="fixed-width">Regimen name</xforms:label>
									</xforms:input>
									<br />
									<xforms:select1 ref="regimenSupervision"
										appearance="minimal">
										<xforms:label class="fixed-width">Supervision</xforms:label>
										<xforms:itemset model="mod-study-questionnaire"
											nodeset="instance('ins-supervisionType-items')/supervisionType">
											<xforms:label ref="label" />
											<xforms:value ref="value" />
										</xforms:itemset>
									</xforms:select1>
									<br />
									<xforms:input ref="regimenUrl">
										<xforms:label class="fixed-width">Description Url
										</xforms:label>
										<xforms:hint>A URL of a page which describes the regimen
										</xforms:hint>
										<xforms:alert>Please enter a valid URL</xforms:alert>
									</xforms:input>

			
									<xforms:group ref="drugs">
										<h5>Drugs</h5>
										<table class="repeat-table">
											<xforms:repeat nodeset="drug" id="rep-drug">
												<tr>
													<td>
														<xforms:trigger appearance="minimal">
															<xforms:delete ev:event="DOMActivate" context="."
																nodeset="." at="index('rep-drug')" />
															<xforms:label>
																<img src="/apps/submitter/common/remove.gif" />
															</xforms:label>
														</xforms:trigger>
													</td>
													<td class="form-td">
														<xforms:input ref="name">
															<xforms:label class="fixed-width">Drug name</xforms:label>
														</xforms:input>
														<br />
														<xforms:select1 ref="administrationRoute"
															appearance="minimal">
															<xforms:label class="fixed-width">Administration Route</xforms:label>
															<xforms:itemset model="mod-study-questionnaire"
																nodeset="instance('ins-administrationRoute-items')/administrationRoute">
																<xforms:label ref="label" />
																<xforms:value ref="value" />
															</xforms:itemset>
														</xforms:select1>
<br />

									<xforms:input ref="manufacturer">
										<xforms:label class="fixed-width">Manufacturer</xforms:label>
										<xforms:hint>The manufacturer of the drug</xforms:hint>
									</xforms:input>
									<xforms:input ref="batchNumber">
										<xforms:label class="fixed-width">Batch Number</xforms:label>
										<xforms:hint>The manufacturer of the drug</xforms:hint>
									</xforms:input>
									<xforms:input ref="expiryDate">
										<xforms:label class="fixed-width">Expiry Date</xforms:label>
										<xforms:hint>The date the drug expires</xforms:hint>
									</xforms:input>
														
														
													</td>
												</tr>
											</xforms:repeat>
											<tr>
												<td>
													<xforms:trigger appearance="minimal">
														<xforms:label>
															<img src="/apps/submitter/common/add.gif" />
														</xforms:label>
														<xforms:insert ev:event="DOMActivate" context="."
															nodeset="drug" 
															at="count(../drug)" position="after"
															origin="instance('ins-drug')" />
													</xforms:trigger>
												</td>
												<td class="add-td">
													<xforms:trigger appearance="minimal">
														<xforms:label>Add a Drug</xforms:label>
														<xforms:insert ev:event="DOMActivate" context="."
															nodeset="drug" 
															at="count(../drug)" position="after"
															origin="instance('ins-drug')" />
													</xforms:trigger>
												</td>
											</tr>
										</table>
										
										
									</xforms:group>








								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td>
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/submitter/common/add.gif" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="regimen" 
										at="count(../regimen)" position="after"
										origin="instance('ins-regimen')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add a Regimen</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="regimen" 
										at="count(../regimen)" position="after"
										origin="instance('ins-regimen')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
					
					
				</xforms:group>
				
				
				
				<xforms:group ref="regimenAllocation">
				
					<xforms:select1 appearance="minimal" ref="regimenAllocationMethod">
						<xforms:label class="fixed-width">
							Regimen allocation</xforms:label>
						<xforms:itemset model="mod-study-questionnaire"
								nodeset="instance('ins-regimenAllocationMethod-items')/regimenAllocationMethod">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
					
					<xforms:input ref="randomisationProportion">
						<xforms:label class="fixed-width">
					<br />
						Proportion</xforms:label>
					</xforms:input>
					<br />
						

					<xforms:select1 appearance="minimal" ref="blinding">
						<xforms:label class="fixed-width">
						Blinding</xforms:label>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-blinding-items')/blinding">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</xforms:group>

			</xforms:group>
		</xforms:group>

		<xforms:group ref="molecular">

			<h2>Molecular Questions</h2>

			<p>TODO</p>

		</xforms:group>

		<xforms:group ref="invitro">

			<h2>
				<i>in vitro</i>
				Module Questions
			</h2>

			<xforms:input ref="analysisSite">
				<xforms:label>Where did the analysis take place?</xforms:label>
				<xforms:hint>
					<em>Enter a site code, or laboratory name and address if the
						analysis did not take place at
						any of the previously entered sites.
					</em>
				</xforms:hint>
			</xforms:input>
			<!--+
			|
			| BEGIN IN VITRO CULTURE NESTED QUESTIONNAIRE
			|
			+-->
			<xforms:group ref="culture">
				<h4>Culture for Drug Susceptibility Measure</h4>

				<xforms:select1 ref="incubatorSystem" appearance="minimal">
					<xforms:label>Incubator system</xforms:label>
					<xforms:item>
						<xforms:label><!-- Nullable -->
						</xforms:label>
						<xforms:value />
					</xforms:item>
					<xforms:itemset model="mod-study-questionnaire"
						nodeset="instance('ins-incubatorSystem-items')/incubatorSystem">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
				</xforms:select1>
				<xforms:input model="mod-study-questionnaire" ref="co2">
					<xforms:label>
						CO
						<sub>2</sub>
						?
						<font color="red">FIXME</font>
					</xforms:label>
					<xforms:hint>
						<p>
							<em>Temperature should be 37&#176;C.</em>
							<em>Don't forget to monitor the incubator system.</em>
						</p>
					</xforms:hint>
				</xforms:input>
				<p>
					<xforms:select1 ref="healthyErythrocytesSource"
						appearance="minimal">
						<xforms:label>Healthy erythrocyte source</xforms:label>
						<xforms:hint>
							<em>Healthy erythrocytes have to be deleucocyted.</em>
						</xforms:hint>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-healthyErythrocytesSource-items')/healthyErythrocytesSource">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</p>
				<p>
					<xforms:input ref="hematocrit">
						<xforms:label>Hematocrit (%)</xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Please enter an integer value between 0 and 100 for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:input>

				</p>
				<p>
					<xforms:select1 ref="bloodGroup" appearance="minimal">
						<xforms:label>Blood group</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-bloodGroup-items')/bloodGroup">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</p>
			</xforms:group>

			<!--
				+ | | BEGIN IN VITRO MEDIUM NESTED QUESTIONNAIRE | +
			-->

			<xforms:group ref="medium">
				<h4>Medium for Drug Susceptibility Measure</h4>
				<p>
					<xforms:select1 ref="medium" appearance="minimal">
						<xforms:label>Medium</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-medium-items')/medium">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
					<em>
						Storage temperature: 6 months at -20&#176;C and 1 week at
						+4&#176;C after using.
						<font color="red">FIXME</font>
					</em>
				</p>
				<p>
					<xforms:select1 ref="preparation" appearance="minimal">
						<xforms:label>Preparation</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-mediumPreparation-items')/mediumPreparation">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</p>
				<p>
					<xforms:select1 ref="serum" appearance="minimal">
						<xforms:label>Serum</xforms:label>
						<xforms:item>
							<xforms:label><!-- Nullable -->
							</xforms:label>
							<xforms:value />
						</xforms:item>
						<xforms:itemset model="mod-study-questionnaire"
							nodeset="instance('ins-serum-items')/serum">
							<xforms:label ref="label" />
							<xforms:value ref="value" />
						</xforms:itemset>
					</xforms:select1>
				</p>

				<p>
					<xforms:input ref="serum-finalConcentration">
						<xforms:label>Serum final concentration (g/L) </xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Please enter an integer value for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:input>
				</p>
				<p>
					<xforms:input ref="NaHCO3-finalConcentration">
						<xforms:label>
							NaHCO
							<sub>3</sub>
							final concentration (g/L)
						</xforms:label>
						<xforms:alert>
							<xforms:output
								value="concat('Please enter an integer value for the ', name(), ' field ')" />
						</xforms:alert>
					</xforms:input>
				</p>

				<xforms:group ref="hypoxantine">
					<h5>Hypoxantine</h5>
					<p>
						<xforms:select1 ref="hypoxantine-added" appearance="minimal">
							<xforms:label>Do you add Hypoxantine?</xforms:label>
							<xforms:alert>Please select a value</xforms:alert>
							<xforms:itemset model="mod-study-questionnaire"
								nodeset="instance('ins-boolean-items')/boolean">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>
					<p>
						<xforms:input ref="hypoxantine-finalConcentration">
							<xforms:label>Final Hypoxantine concentration (g/L)
							</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Please enter an integer value for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>
				</xforms:group>


				<xforms:group ref="oroticAcid">
					<h5>Orotic Acid</h5>
					<p>
						<xforms:select1 ref="oroticAcid-added" appearance="minimal">
							<xforms:label>Do you add Orotic Acid?</xforms:label>
							<xforms:alert>Please select a value</xforms:alert>
							<xforms:itemset model="mod-study-questionnaire"
								nodeset="instance('ins-boolean-items')/boolean">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>
					<p>
						<xforms:input ref="oroticAcid-finalConcentration">
							<xforms:label>Final Orotic Acid concentration (g/L)
							</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Please enter an integer value for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>
				</xforms:group>

				<xforms:group ref="glucose">
					<h5>Glucose</h5>
					<p>
						<xforms:select1 ref="glucose-added" appearance="minimal">
							<xforms:label>Do you add glucose?</xforms:label>
							<xforms:itemset model="mod-study-questionnaire"
								nodeset="instance('ins-boolean-items')/boolean">
								<xforms:label ref="label" />
								<xforms:value ref="value" />
							</xforms:itemset>
						</xforms:select1>
					</p>
					<p>
						<xforms:input ref="glucose-finalConcentration">
							<xforms:label>Final glucose concentration (g/L)</xforms:label>
							<xforms:alert>
								<xforms:output
									value="concat('Please enter an integer value for the ', name(), ' field ')" />
							</xforms:alert>
						</xforms:input>
					</p>
				</xforms:group>


				<xforms:group ref="antiBiotics">
					<p>
						If you use antibiotics, please fill in the section below for
						each
						antibiotic you use. 
					</p>
					<table class="repeat-table">
						<xforms:repeat nodeset="antiBiotic" id="antiBiotic-rep">
							<tr>
								<td>
									<xforms:trigger appearance="minimal">
										<xforms:delete ev:event="DOMActivate" context="."
											nodeset="." at="index('antiBiotic-rep')" />
										<xforms:label>
											<img src="/apps/submitter/common/remove.gif" />
										</xforms:label>
									</xforms:trigger>
								</td>
								<td>
									<p>
										<xforms:input ref="antiBioticName">
											<xforms:label>Name of antibiotic</xforms:label>
											<xforms:alert>Required field</xforms:alert>
										</xforms:input>
									</p>
									<p>
										<xforms:input ref="antiBioticFinalConcentration">
											<xforms:label>AntiBiotic final concentration (g/L)
											</xforms:label>
											<xforms:alert>
												<xforms:output
													value="concat('Please enter an integer value for the ', name(), ' field ')" />
											</xforms:alert>
										</xforms:input>
									</p>
								</td>
							</tr>
						</xforms:repeat>
						<tr>
							<td>
								<xforms:trigger appearance="minimal">
									<xforms:label>
										<img src="/apps/submitter/common/add.gif" />
									</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										nodeset="antiBiotic" 
										at="count(../antiBiotic)" position="after"
										origin="instance('ins-antiBiotic')" />
								</xforms:trigger>
							</td>
							<td class="add-td">
								<xforms:trigger appearance="minimal">
									<xforms:label>Add an Antibiotic</xforms:label>
									<xforms:insert ev:event="DOMActivate" context="."
										at="count(../antiBiotic)" position="after" 
										origin="instance('ins-antiBiotic')" />
								</xforms:trigger>
							</td>
						</tr>
					</table>
				</xforms:group>
			</xforms:group>
			<!--
				+ | | BEGIN IN VITRO SUSCEPTIBILITY NESTED QUESTIONNAIRE | +
			-->


			<xforms:group ref="susceptibility">
				<h4>Determination of Drug Susceptibility</h4>
				<p>
					<em>
						If this information is different for each sample, please
						include it
						in your raw data.
					</em>
				</p>
				<xforms:select1 appearance="minimal" ref="timeOfIncubation">
					<xforms:label class="fixed-width">Time of incubation</xforms:label>
					<xforms:item>
						<xforms:label><!-- Nullable -->
						</xforms:label>
						<xforms:value />
					</xforms:item>
					<xforms:itemset model="mod-study-questionnaire"
						nodeset="instance('ins-incubationTime-items')/incubationTime">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
				</xforms:select1>
				<br />
				<p>
					<em>
						If this information is different for each sample, please
						include it
						in your raw data.
					</em>
				</p>
				<xforms:select1 appearance="minimal" ref="susceptibilityMethod">
					<xforms:label class="fixed-width">Method used</xforms:label>
					<xforms:item>
						<xforms:label><!-- Nullable -->
						</xforms:label>
						<xforms:value />
					</xforms:item>
					<xforms:itemset model="mod-study-questionnaire"
						nodeset="instance('ins-susceptibilityMethod-items')/susceptibilityMethod">
						<xforms:label ref="label" />
						<xforms:value ref="value" />
					</xforms:itemset>
				</xforms:select1>
			</xforms:group>

			<!--
				+ | | END IN VITRO SUSCEPTIBILITY NESTED QUESTIONNAIRE | +
			-->


			<!--
				+ | | BEGIN IN VITRO DRUG STOCK SOLUTIONS NESTED QUESTIONNAIRE | +
			-->

			<xforms:group ref="drugs">
				<h4>Drug Stock Solutions</h4>

				<p>
					<em>Please complete the section below for each drug stock solution
						used.</em>
				</p>

				<table class="repeat-table">
					<xforms:repeat nodeset="drug" id="drug-rep">
						<tr>
							<td>
								<xforms:trigger appearance="minimal">
									<xforms:delete ev:event="DOMActivate" context="."
										nodeset="." at="index('drug-rep')" />
									<xforms:label>
										<img src="/apps/submitter/common/remove.gif" />
									</xforms:label>
								</xforms:trigger>
							</td>
							<td>
								<xforms:select1 appearance="minimal" ref="molecule">
									<xforms:label class="fixed-width">Molecule</xforms:label>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:itemset model="mod-study-questionnaire"
										nodeset="instance('ins-drugMolecule-items')/drugMolecule">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
									<xforms:alert>Please select a drug molecule</xforms:alert>
								</xforms:select1>
								<br />

								<xforms:select1 appearance="minimal" ref="solvent">
									<xforms:label class="fixed-width">Stock solution solvent
									</xforms:label>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:itemset model="mod-study-questionnaire"
										nodeset="instance('ins-drugSolvent-items')/drugSolvent">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
									<xforms:alert>Please select a value</xforms:alert>
								</xforms:select1>
								<br />

								<xforms:input ref="solventFinalConcentration">
									<xforms:label>Solvent final concentration (g/L)</xforms:label>
									<xforms:alert>
										<xforms:output
											value="concat('Please enter an integer value for the ', name(), ' field ')" />
									</xforms:alert>
								</xforms:input>

								<br />
								<xforms:select1 appearance="minimal" ref="providedByWwarn">
									<xforms:label>Were stock solutions provided by WWARN?
									</xforms:label>
									<xforms:alert>Please answer yes or no</xforms:alert>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:itemset model="mod-study-questionnaire"
										nodeset="instance('ins-boolean-items')/boolean">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
								</xforms:select1>

								<br />
								<xforms:input ref="provider">
									<xforms:label>Who provided the drug?</xforms:label>
								</xforms:input>


							</td>
						</tr>
					</xforms:repeat>
					<tr>
						<td>
							<xforms:trigger appearance="minimal">
								<xforms:label>
									<img src="/apps/submitter/common/add.gif" />
								</xforms:label>
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="drug" at="count(../drug)" position="after"
									origin="instance('ins-invitro-drug-template')" />
							</xforms:trigger>
						</td>
						<td class="add-td">
							<xforms:trigger appearance="minimal">
								<xforms:label>Add a Drug</xforms:label>
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="drug" at="count(../drug)" position="after"
									origin="instance('ins-invitro-drug-template')" />
							</xforms:trigger>
						</td>
					</tr>
				</table>
			</xforms:group>

			<!--
				+ | | END IN VITRO DRUG STOCK SOLUTIONS NESTED QUESTIONNAIRE | +
			-->


			<!--
				+ | | BEGIN IN VITRO PLATES NESTED QUESTIONNAIRE | +
			-->

			<h4 id="plates">Batches of Plates</h4>

			<xforms:group ref="plateBatches">
				<table class="repeat-table">
					<xforms:repeat nodeset="batch" id="batch-rep">
						<tr>
							<td>

								<xforms:trigger appearance="minimal">
									<xforms:delete ev:event="DOMActivate" context="."
										nodeset="." at="index('batch-rep')" />
									<xforms:label>
										<img src="/apps/submitter/common/remove.gif" />
									</xforms:label>
								</xforms:trigger>
							</td>
							<td>
								<xforms:select1 appearance="minimal"
									ref="clone3D7ProvidedByWwarn">
									<xforms:label class="fixed-width">Were 3D7 provided by WWARN?
									</xforms:label>
									<xforms:alert>Please answer yes or no</xforms:alert>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:itemset model="mod-study-questionnaire"
										nodeset="instance('ins-boolean-items')/boolean">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
								</xforms:select1>

								<br />

								<xforms:input ref="clone3D7Provider">
									<xforms:label>Who provided the clone?</xforms:label>
								</xforms:input>

								<br />

								<xforms:select1 appearance="minimal"
									ref="batchesIncludedInRawData">
									<xforms:label>Are your batch preparation dates and 3D7
										information
										included with the raw data?</xforms:label>
									<xforms:alert>Please answer yes or no</xforms:alert>
									<xforms:item>
										<xforms:label>please select</xforms:label>
										<xforms:value />
									</xforms:item>
									<xforms:itemset model="mod-study-questionnaire"
										nodeset="instance('ins-boolean-items')/boolean">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
								</xforms:select1>

								<xforms:group ref="notIncludedBatchDataHint">
									<p>
										<em>
											If batch preparation dates and 3D7 information are
											<strong>not</strong>
											included with the raw data, please complete the section below
											for each batch.
										</em>
									</p>
								</xforms:group>

								<br />
								<xforms:input ref="preparationDate">
									<xforms:label class="fixed-width">Preparation date
									</xforms:label>
								</xforms:input>
								<br />


								<xforms:input ref="parasitaemia3D7">
									<xforms:label class="fixed-width">3D7 parasitaemia (%)
									</xforms:label>
								</xforms:input>
								<br />

								<xforms:input ref="ringForms">
									<xforms:label class="fixed-width">Ring forms after
										synchronisation
										(%)</xforms:label>
								</xforms:input>

							</td>
						</tr>
					</xforms:repeat>
					<tr>
						<td>
							<xforms:trigger appearance="minimal">
								<xforms:label>
									<img src="/apps/submitter/common/add.gif" />
								</xforms:label>
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="batch" at="count(../batch)" position="after"
									origin="instance('ins-invitro-batch-template')" />
							</xforms:trigger>
						</td>
						<td class="add-td">
							<xforms:trigger appearance="minimal">
								<xforms:label>Add a Batch</xforms:label>
								<xforms:insert ev:event="DOMActivate" context="."
									nodeset="batch" at="count(../batch)" position="after"
									origin="instance('ins-invitro-batch-template')" />
							</xforms:trigger>
						</td>
					</tr>
				</table>
			</xforms:group>

			<!--+
			|
			| END IN VITRO PLATES NESTED QUESTIONNAIRE
			|
			+-->


		</xforms:group>

		<xforms:group ref="pharmacology">

			<h2>Pharmacology Questions</h2>

			<p>TODO</p>

		</xforms:group>

	</xforms:group>
		<p>
			<xforms:submit submission="sub-put-study-entry">
				<xforms:label>Save Changes</xforms:label>
			</xforms:submit>
		</p>

</div>
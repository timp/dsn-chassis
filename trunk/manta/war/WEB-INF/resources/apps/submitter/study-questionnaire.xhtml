<!--
  Copyright (C) 2010 University of Oxford.
  
  This program is free software; you can redistribute it and/or modify it under the terms of the
  GNU Lesser General Public License as published by the Free Software Foundation; either version
  2.1 of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  See the GNU Lesser General Public License for more details.

  The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
  -->
<html 
	xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns:f="http://orbeon.org/oxf/xml/formatting" 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:manta="http://www.cggh.org/2010/chassis/manta/xmlns">
    
    <head>
    
        <title>WWARN Data Management - Submitter - Study <xforms:output model="mod-main" value="instance('ins-study-entry')/manta:id"/> - Questionnaire</title>
        <link rel="stylesheet" type="text/css" href="/apps/submitter/common/style.css"></link>
        <style type="text/css"></style>

        <xforms:model id="mod-main">
        
        	<xforms:instance id="ins-study-entry" src="/apps/common/templates/study/study-entry-template.xml"/>
			
       		<xforms:bind nodeset="instance('ins-study-entry')">
       		
				<xi:include href="/apps/common/includes/study/publications-xforms-bindings.xml"/>
				       			
       		</xforms:bind>
       	
       		<xforms:instance id="ins-publication-template" src="/apps/common/templates/study/publication-template.xml"/>
       		<xforms:instance id="ins-person-template" src="/apps/common/templates/study/person-template.xml"/>
       		<xforms:instance id="ins-pathogens-items" src="/apps/common/constants/pathogens.xml"/>
       		<xforms:instance id="ins-site-template" src="/apps/common/templates/study/site-template.xml"/>
       		<xforms:instance id="ins-countries-items" src="/apps/common/constants/countries.xml"/>
       		<xforms:instance id="ins-modules-items" src="/apps/common/constants/modules.xml"/>
       		

			<xforms:submission 
				id="sub-get-study-entry"
				resource="{xxforms:get-request-parameter('study')}"
				method="get"
				replace="instance"
				instance="ins-study-entry"
				ref="instance('ins-noparams')">
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('response-status-code')"/>) while retrieving the study.</xforms:message>
			</xforms:submission>

			<xforms:send ev:event="xforms-model-construct-done" submission="sub-get-study-entry"/>
			
			<xforms:submission
				id="sub-put-study-entry"
				resource="{instance('ins-study-entry')/atom:link[@rel='edit']/@href}"
				method="put"
				replace="instance"
				instance="ins-study-entry"
				ref="instance('ins-study-entry')"
				mediatype="application/atom+xml">
                <xforms:message ev:event="xforms-submit-error" level="modal">An error occurred (<xforms:output value="event('response-status-code')"/>) while saving the study.</xforms:message>
                <xforms:message ev:event="xforms-submit-done" level="modal">Your changes have been saved, thank you.</xforms:message>
			</xforms:submission>

        	<xforms:instance id="ins-noparams">
        		<params/>
        	</xforms:instance>
        	

        </xforms:model>
        
       	<xi:include href="/apps/common/includes/current-user-xforms-model.xml"/>
            
        
    </head>
    <body>
    	<h1>Submitter - Study <xforms:output model="mod-main" value="instance('util')/code"/> - Questionnaire</h1>

    	<div id="home-nav">Links: <a href="home">Submitter Home</a> | <xforms:output model="mod-current-user" value="instance('ins-current-user')/name"/></div>
    	
    	<div id="content">
    	
    		<xforms:group model="mod-main" ref="instance('ins-study-entry')">

	    		<p><xforms:output value="atom:title"><xforms:label class="fixed-width">Study title:</xforms:label></xforms:output></p>
	    		<p><xforms:output value="manta:id"><xforms:label class="fixed-width">Code:</xforms:label></xforms:output></p>
    		
		    	<p>Links: <a href="view-study?study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">View Study</a></p>
    		
    			<p>
    				<xforms:submit submission="sub-put-study-entry">
    					<xforms:label>Save Changes</xforms:label>
    				</xforms:submit>
    			</p>
    			
				<xforms:group ref="atom:content/study">
				
		    		<h2>General Questions</h2>
		    	
		    		<h3>Publications</h3>
		    		
					<xi:include href="/apps/common/includes/study/publications-xforms-input.xml"/>
					
					<h3>Study Start and End</h3>

					<p>
						<xforms:input ref="start">
							<xforms:label>Start: </xforms:label>
						</xforms:input>
					</p>				
					
					<p>
						<xforms:input ref="end">
							<xforms:label>End: </xforms:label>
						</xforms:input>
					</p>	
					
					<h3>Principal Investigators</h3>
										
					<xi:include href="/apps/common/includes/study/principal-investigators-xforms-input.xml"/>
					
					<h3>Pathogen Species</h3>
					
					<p>
						<xforms:select ref="pathogens" appearance="full">
							<xforms:label/>
							<xforms:itemset nodeset="instance('ins-pathogens-items')/pathogen">
								<xforms:label ref="label"/>
								<xforms:value ref="value"/>
							</xforms:itemset>
						</xforms:select>
					</p>
					
					<h3>Study Site(s)</h3>

					<xi:include href="/apps/common/includes/study/sites-xforms-input.xml"/>
					
					<h3>Study Type (WWARN Modules)</h3>

					<p>
						<xforms:select ref="modules" appearance="full">
							<xforms:label/>
							<xforms:itemset nodeset="instance('ins-modules-items')/module">
								<xforms:label ref="label"/>
								<xforms:value ref="value"/>
							</xforms:itemset>
						</xforms:select>
					</p>

 				</xforms:group>			

			</xforms:group>  	
	    	
    	</div>
    </body>
</html>


<?oxygen NVDLSchema="../../../../../../../oxygen/samples/nvdl/xhtml-xforms-11-orbeon.nvdl"?>
<div 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:xforms="http://www.w3.org/2002/xforms"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
	xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xi="http://www.w3.org/2001/XInclude">

	<div id="bd" class="clearfix no-help-box">
		
		<div class="no-bg">
			
			<!-- Help boxes. Comment out if not needed. -->
<!--			<div class="help">

						 <xi:include href="../help-boxes/for-dashboard-tabs/for-contributor/summary.xml"/>  

				
			</div>-->
			
			
			<div class="main oneCol">
				
				<div id="content" class="study-dashboard">
					
					<h1>Study dashboard - <xforms:output value="instance('ins-study-entry')/atom:title"/> (<xforms:output value="instance('ins-study-entry')/manta:id"/>)</h1>
					
					
						<div class="yui-navset yui-navset-top">
							
							<ul class="yui-nav">
					
									<li >
										<a href="dashboard?tab=summary&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
											<em>Summary</em>
										</a>
									</li>
					
								<li class="selected">
										<a href="dashboard?tab=status&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
											<em>Status</em>
										</a>
									</li>
								<!-- If the user has GET access to the security descriptor. -->
								<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='http://purl.org/atombeat/rel/security-descriptor' and contains(@atombeat:allow, 'GET')]">
									
					
										<li id="permissions-tab-link-container">
											<a href="dashboard?tab=permissions&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
												<em>Permissions</em>
											</a>
										</li>
									
								</xforms:group>
								
					
									<li id="acknowledgements-tab-link-container">
										<a href="dashboard?tab=acknowledgements&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
											<em>Acknowledgements</em>
										</a>
									</li>
								
								<!-- If the user has GET access to the submitted media. -->
								<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='http://www.cggh.org/2010/chassis/terms/submittedMedia' and contains(@atombeat:allow, 'GET')]">
					
										<li id="files-tab-link-container">
											<a href="dashboard?tab=files&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
												<em>Files</em>
											</a>
										</li>
									
								</xforms:group>	
								
					
									<li id="publications-tab-link-container">
										<a href="dashboard?tab=publications&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
											<em>Publications</em>
										</a>
									</li>
								
					
									<li id="study-info-tab-link-container">
										<a href="dashboard?tab=study-info&amp;study={instance('ins-study-entry')/atom:link[@rel='edit']/@href}">
											<em>Study info</em>
										</a>
									</li>
								
							</ul>
							
							
							<div class="yui-content">
							
								<xforms:group ref="instance('ins-study-entry')">
									
									<p><!-- Only curator can view/edit curator notes and change status -->
										
										<p>If you wish to make changes to this study then please <a href="mailto:curator@wwarn.org?subject=Please enable {instance('ins-study-entry')/atom:title} ({instance('ins-study-entry')/manta:id}) for editing">mail curator@wwarn.org</a> and they will enable you to make changes.</p>
										
										<xforms:group ref="instance('ins-control')/curator-controls">
											Curator
											<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and contains(@atombeat:allow, 'GET')]">
												<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and (contains(@atombeat:allow, 'PUT'))]">
													<p>
														<xforms:select1 ref="instance('ins-study-entry')//study/study-status" appearance="minimal">
															<xforms:label>Study Status</xforms:label>
															<xforms:itemset model="mod-study-dashboard"
																nodeset="instance('ins-study-status')//statusType">
																<xforms:label ref="label" />
																<xforms:value ref="value" />
															</xforms:itemset>
														</xforms:select1>
														<xforms:input ref="atom:content/study/study-status">
															<xforms:label>Status:</xforms:label>
														</xforms:input>				
													</p>
													<p>
													<xforms:input model="mod-study-dashboard" ref="instance('ins-study-entry')//study/curator-notes">
														<xforms:label>Notes:</xforms:label>
													</xforms:input>
													</p>
												</xforms:group>
												<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and contains(@atombeat:allow, 'GET')]">
													<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and not(contains(@atombeat:allow, 'PUT'))]">
														<p>
															
																	<xforms:output ref="instance('ins-study-status')/statusType[value=instance('ins-study-entry')//study/study-status/text()]/label">
																		<xforms:label>Status:</xforms:label>
																	</xforms:output>
																			
														</p>
														<p>
															<xforms:output model="mod-study-dashboard" ref="instance('ins-study-entry')//study/curator-notes">
																<xforms:label>Notes:</xforms:label>
															</xforms:output>
														</p>	
													</xforms:group>
												</xforms:group>
											</xforms:group>
											
										</xforms:group> 
							
										
									</p>
								</xforms:group>
								<xforms:group model="mod-current-user" ref="instance('ins-current-user')//role[not(. = 'ROLE_CHASSIS_CURATOR')]">
									Not curator
									<xforms:output ref="instance('ins-current-user')//role[. = 'ROLE_CHASSIS_CURATOR']"/>
									<p>
										<xforms:output model="mod-study-dashboard" ref="instance('ins-study-status')/statusType[value=instance('ins-study-entry')//study/study-status/text()]/label">
											<xforms:label>Status:</xforms:label>
										</xforms:output>			
									</p>
									
								</xforms:group>

								<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and (contains(@atombeat:allow, 'PUT'))]">
									<p>
										<span id="title-save-changes-button-container">
											<xforms:trigger ref="instance('ins-control')/save-study-trigger">
												<xforms:label>Save changes - all changes complete</xforms:label>
												<xforms:action ev:event="DOMActivate" if="../study-entry-is-valid = 'true'">
													<xforms:send submission="sub-notify-put-study-entry-complete"/>
												</xforms:action>
												<xforms:action ev:event="DOMActivate" if="not(../study-entry-is-valid = 'true')">
													<xforms:message>Please complete all required fields.</xforms:message>
												</xforms:action>
											</xforms:trigger>
										</span>
									</p>
								</xforms:group>
								
								<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit' and (contains(@atombeat:allow, 'PUT'))]">
								<p>
									<span id="title-save-changes-button-container">
										<xforms:trigger ref="instance('ins-control')/save-study-trigger">
											<xforms:label>Save changes</xforms:label>
											<xforms:action ev:event="DOMActivate" if="../study-entry-is-valid = 'true'">
												<xforms:send submission="sub-notify-put-study-entry"/>
											</xforms:action>
											<xforms:action ev:event="DOMActivate" if="not(../study-entry-is-valid = 'true')">
												<xforms:message>Please complete all required fields.</xforms:message>
											</xforms:action>
										</xforms:trigger>
									</span>
								</p>
								</xforms:group>
							</div>
							
						</div>

				</div>
			</div>
		</div>
	</div>


</div>		
<?oxygen NVDLSchema="../../../../../../../oxygen/samples/nvdl/xhtml-xforms-11-orbeon.nvdl"?>
<div 
	xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:xforms="http://www.w3.org/2002/xforms" 
	xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	 xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:manta="http://www.cggh.org/2010/chassis/manta/xmlns">

	<div id="bd" class="clearfix">
		<div class="steps clearfix">

				<h1>Register study</h1>
				<ul>
					<li class="active">Step 1</li>
					<li>Step 2</li>
					<li>Step 3</li>
					<li>Step 4</li>
					<li>Step 5</li>
					<li>Review</li>
				</ul>
			
			
		</div>
		<div class="no-bg">
			
			<xi:include href="../help-boxes/for-wizard-panes/study-terms.xml"/>

			<div class="main twoCol">
				<div id="content" class="register-study-wizard">
					
						<h2>Study terms</h2>
					<xforms:group ref="instance('ins-study-entry')//study">
						<p>
							<span id="study-title-textbox-container">
								<xforms:input ref="studyTitle">
									<xforms:label>Study title:</xforms:label>
									<xforms:alert>The title is required.</xforms:alert>
								</xforms:input>
							</span>
						</p>

						<p>
								<xforms:select ref="modules" appearance="full">
									<xforms:label>WWARN modules:</xforms:label>
									<xforms:itemset
										nodeset="instance('ins-module-items')/module" class="repeated-element">
										<xforms:label ref="label" />
										<xforms:value ref="value" />
									</xforms:itemset>
									<xforms:alert>Appropriate questions are displayed only when a
										module is selected</xforms:alert>
								</xforms:select>
						</p>
					
						<iframe src="terms" class="terms-iframe">
							<p>
								<a href="terms" target="_blank">View the Terms of Submission as a webpage</a>
							</p>
						</iframe>
						
						<p>
							
							<span id="agree-to-terms-checkbox-container">
							
							  <xforms:group ref="instance('ins-control')/curator-controls">
							   <xforms:group ref="instance('ins-study-entry')//study">
								<xforms:select1 ref="registrant-has-agreed-to-the-terms" appearance="full">
									
									<xforms:item>
										<xforms:label>I accept the Terms of Submission<br/></xforms:label>
										<xforms:value>yes</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>I am submitting on behalf of somebody<br/></xforms:label>
										<xforms:value>proxy</xforms:value>
									</xforms:item>
									<xforms:item>
										<xforms:label>This is derived data from a previously uploaded study<br/></xforms:label>
										<xforms:value>derived</xforms:value>
									</xforms:item>
									
									<xforms:alert>Agreement to the Terms of Submission is required.</xforms:alert>
								
								</xforms:select1>
								<xforms:input ref="proxy-for-name">
									<xforms:label>Name:</xforms:label>
								  </xforms:input>
								 <br/>
								  <xforms:input ref="proxy-for-institution">
									<xforms:label>Institution:</xforms:label>
								  </xforms:input>
								  
								  
							      <xforms:select1 ref="derived-study-id">
									<xforms:label></xforms:label>
															
									<xforms:item>
										<xforms:label>Select...</xforms:label>
										<xforms:value></xforms:value>
									</xforms:item>
															
									<xforms:itemset nodeset="xxforms:sort(instance('ins-study-feed')/atom:entry[(empty(app:control) or app:control/app:draft != 'yes')], atom:published, 'text', 'ascending')">
										<xforms:label ref="concat(manta:id,' ',atom:content/study/studyTitle)"/>
										<xforms:value ref="manta:id"/>
									</xforms:itemset>
								  </xforms:select1>
								</xforms:group>
					 		  </xforms:group>
					 		  <xforms:group ref="instance('ins-control')/contributor-only-controls">
   					 		   <span>I accept the Terms of Submission:</span>
					 		   <xforms:group ref="instance('ins-study-entry')//study">
								<xforms:select ref="registrant-has-agreed-to-the-terms" appearance="full">
									<xforms:label class="invisible"/>
									<xforms:item>
										<xforms:label/>
										<xforms:value>yes</xforms:value>
									</xforms:item>
									
									
									<xforms:alert>Agreement to the Terms of Submission is required.</xforms:alert>
								
								</xforms:select>
								</xforms:group>
					 		  </xforms:group>
			                    
							</span>
							
						</p>
					
					
						<p class="form-navi">
						
							
							
					
							<span id="study-terms-next-button-container" class="alignRight">
								<xforms:trigger
									ref="instance('ins-control')/create-draft-trigger">
									<xforms:label>Next &gt;</xforms:label>
									<xforms:action ev:event="DOMActivate"
										if="../draft-entry-is-valid = 'true'">
										<xforms:setvalue
											ref="instance('ins-study-entry')//wizard-pane-to-show"
											value="'permissions'" />
										<xforms:send submission="sub-post-contribution" />
									</xforms:action>
									<xforms:action ev:event="DOMActivate"
										if="not(../draft-entry-is-valid = 'true')">
										<xforms:message>
											<!-- Please complete all required fields.  -->
											You must enter a study title and accept the Terms of Submission before continuing to register your study.
										</xforms:message>
									</xforms:action>
								</xforms:trigger>
							</span>
					
					
					
							<xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit']">
								<div>
										<xforms:trigger
											ref="instance('ins-control')/save-draft-trigger" class="alignCenter">
											<xforms:label>Save as draft</xforms:label>
											<xforms:action ev:event="DOMActivate"
												if="../draft-entry-is-valid = 'true'">
												<xforms:send
													submission="sub-explicit-put-draft-entry" />
											</xforms:action>
											<xforms:action ev:event="DOMActivate"
												if="not(../draft-entry-is-valid = 'true')">
												<xforms:message>
													Please complete all required fields.
												</xforms:message>
											</xforms:action>
										</xforms:trigger>
										<span class="alignRight">
									<xforms:trigger ref="instance('ins-control')/save-draft-trigger">
										<xforms:label>Next &gt;</xforms:label>
										<xforms:action ev:event="DOMActivate" if="../draft-entry-is-valid = 'true'">
											<xforms:setvalue ref="instance('ins-study-entry')//wizard-pane-to-show" value="'permissions'" />
											<xforms:send submission="sub-implicit-put-draft-entry" />
										</xforms:action>
										<xforms:action ev:event="DOMActivate" if="not(../draft-entry-is-valid = 'true')">
											<xforms:message>Please complete all required fields.</xforms:message>
										</xforms:action>
									</xforms:trigger>
								</span>
								</div>
							</xforms:group>
					
							<span class="skip-links"><xforms:group ref="instance('ins-control')/pre-create-draft-back-home-link">
								<a href="home" class="alignLeft">&lt;&lt; Data home</a>
							</xforms:group><xforms:group ref="instance('ins-study-entry')/atom:link[@rel='edit']">
								<xforms:trigger
									ref="instance('ins-control')/save-draft-trigger"
									appearance="minimal" class="alignLeft">
									<xforms:label>&lt;&lt; Data home</xforms:label>
									<xforms:action ev:event="DOMActivate"
										if="../draft-entry-is-valid = 'true'">
										<xforms:send submission="sub-back-home" />
									</xforms:action>
									<xforms:action ev:event="DOMActivate"
										if="not(../draft-entry-is-valid = 'true')">
										<xforms:message>
											Please complete all required fields.
										</xforms:message>
									</xforms:action>
								</xforms:trigger>
								<xforms:trigger
									ref="instance('ins-control')/save-draft-trigger"
									appearance="minimal" class="alignRight">
									<xforms:label>Skip to end &gt;&gt;</xforms:label>
									<xforms:action ev:event="DOMActivate"
										if="../draft-entry-is-valid = 'true'">
										<xforms:setvalue
											ref="instance('ins-study-entry')//wizard-pane-to-show"
											value="'review'" />
										<xforms:send
											submission="sub-implicit-put-draft-entry" />
									</xforms:action>
									<xforms:action ev:event="DOMActivate"
										if="not(../draft-entry-is-valid = 'true')">
										<xforms:message>
											Please complete all required fields.
										</xforms:message>
									</xforms:action>
								</xforms:trigger>
					</xforms:group></span>
					
						</p>
						</xforms:group>	
				</div>
			</div>
		</div>
	</div>

</div>